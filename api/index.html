<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API reference - CDIPpy Docs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API reference";
        var mkdocs_page_input_path = "api.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> CDIPpy Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../quickstart/">Quick start</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API reference</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.cdipnc">cdipnc</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.Active">Active</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Active.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.ActiveXY">ActiveXY</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.ActiveXY.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.Archive">Archive</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Archive.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Archive.get_request">get_request</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Archive.get_xyz_timestamp">get_xyz_timestamp</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.__get_indices">__get_indices</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.__make_masked_array">__make_masked_array</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_coverage_end">get_coverage_end</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_coverage_start">get_coverage_start</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_dataset_urls">get_dataset_urls</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_date_modified">get_date_modified</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_flag_meanings">get_flag_meanings</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_flag_values">get_flag_values</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_pub_set">get_pub_set</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_request">get_request</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_var">get_var</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.get_var_prefix">get_var_prefix</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.make_pub_mask">make_pub_mask</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.metaStationName">metaStationName</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.set_dataset_info">set_dataset_info</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.set_request_info">set_request_info</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.CDIPnc.set_timespan">set_timespan</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.Historic">Historic</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Historic.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.Latest">Latest</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.__has_a_number">__has_a_number</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.get_latest">get_latest</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaDeployLabels">metaDeployLabels</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaDeployNumbers">metaDeployNumbers</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaLatitudes">metaLatitudes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaLongitudes">metaLongitudes</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaSiteLabels">metaSiteLabels</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaStationNames">metaStationNames</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaWMOids">metaWMOids</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Latest.metaWaterDepths">metaWaterDepths</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.Realtime">Realtime</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.Realtime.__init__">__init__</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.cdipnc.RealtimeXY">RealtimeXY</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.cdipnc.RealtimeXY.__init__">__init__</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.nchashes">nchashes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.nchashes.NcHashes">NcHashes</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.nchashes.NcHashes.compare_hash_tables">compare_hash_tables</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.ncstats">ncstats</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.ncstats.NcStats">NcStats</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.by_month_count">by_month_count</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.deployment_summary">deployment_summary</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.flag_counts">flag_counts</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.load_file">load_file</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.load_nc_files">load_nc_files</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.make_stats">make_stats</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.nc_file_summary">nc_file_summary</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.ncstats.NcStats.total_count">total_count</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.ndbc">ndbc</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.ndbc.get_stn_info">get_stn_info</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.ndbc.get_wmo_id">get_wmo_id</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.plotting">plotting</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.plotting.make_annual_hs_boxplot">make_annual_hs_boxplot</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.plotting.make_compendium_plot">make_compendium_plot</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.plotting.make_sst_climatology_plot">make_sst_climatology_plot</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.spectra">spectra</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.spectra.Spectra">Spectra</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.__str__">__str__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.get_bandSize">get_bandSize</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.get_spectraNum">get_spectraNum</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.get_spectraType">get_spectraType</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.redist_specArr">redist_specArr</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.set_spectrumArr_fromQuery">set_spectrumArr_fromQuery</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.specArr_ToDict">specArr_ToDict</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectra.whichSpecClass">whichSpecClass</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.spectra.Spectrum">Spectrum</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.calc_Hs">calc_Hs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.freq_cutoffs">freq_cutoffs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.get_Energy">get_Energy</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.get_SigWaveHt">get_SigWaveHt</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.ma_to_list">ma_to_list</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.peri_cutoffs">peri_cutoffs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.recip">recip</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.redistribute_sp">redistribute_sp</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.set_FreqBands">set_FreqBands</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.set_specAtts">set_specAtts</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.spectra.Spectrum.total_Hs">total_Hs</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#cdippy.stndata">stndata</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#cdippy.stndata.StnData">StnData</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData--methods">METHODS</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.__aggregate_dicts">__aggregate_dicts</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.__init__">__init__</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.__merge_active_request">__merge_active_request</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.__merge_request">__merge_request</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.__merge_xyz_request">__merge_xyz_request</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_nc_files">get_nc_files</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_parameters">get_parameters</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_series">get_series</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_spectra">get_spectra</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_stn_meta">get_stn_meta</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_target_timespan">get_target_timespan</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.get_xyz">get_xyz</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cdippy.stndata.StnData.remove_duplicates">remove_duplicates</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Users guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../user_guide/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../user_guide/data_access/">Data access</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../user_guide/plotting/">Data visualization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developers guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../dev_guide/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev_guide/contribute/">Contributing</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">CDIPpy Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">API reference</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cdippy-api-reference">CDIPpy API reference</h1>


<div class="doc doc-object doc-module">



<h2 id="cdippy.cdipnc" class="doc doc-heading">
            <code>cdippy.cdipnc</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.Active" class="doc doc-heading">
            <code>Active</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CDIPnc (cdippy.cdipnc.CDIPnc)" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a></code></p>


        <p>Loads an "active" (predeploy, moored, offsite, recovered) rt nc file
for the given station and deployment.</p>
<p>E.g. a = Active('100', 6, 'predeploy')  # The predeploy data for stn 100 dep 6.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Active</span><span class="p">(</span><span class="n">CDIPnc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads an &quot;active&quot; (predeploy, moored, offsite, recovered) rt nc file</span>
<span class="sd">    for the given station and deployment.</span>

<span class="sd">    E.g. a = Active(&#39;100&#39;, 6, &#39;predeploy&#39;)  # The predeploy data for stn 100 dep 6.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">active_state_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        stn : str</span>
<span class="sd">           Can be in 2, 3 or 5 char format e.g. 28, 028, 028p2</span>
<span class="sd">        active_state_key : str</span>
<span class="sd">            Values: predeploy|moored|offsite|recovered</span>
<span class="sd">        deployment : int [optional]</span>
<span class="sd">            Supply this to access specific station deployment data.</span>
<span class="sd">            Must be &gt;= 1.</span>
<span class="sd">        data_dir : str [optional]</span>
<span class="sd">            Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">            of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="n">active_state_key</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_default</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Active.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">active_state_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <h6 id="cdippy.cdipnc.Active.__init__--parameters">PARAMETERS</h6>
<p>stn : str
   Can be in 2, 3 or 5 char format e.g. 28, 028, 028p2
active_state_key : str
    Values: predeploy|moored|offsite|recovered
deployment : int [optional]
    Supply this to access specific station deployment data.
    Must be &gt;= 1.
data_dir : str [optional]
    Either a full path to a directory containing a local directory hierarchy
    of nc files. E.g. '/project/WNC' or a url to a THREDDS server.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">active_state_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    stn : str</span>
<span class="sd">       Can be in 2, 3 or 5 char format e.g. 28, 028, 028p2</span>
<span class="sd">    active_state_key : str</span>
<span class="sd">        Values: predeploy|moored|offsite|recovered</span>
<span class="sd">    deployment : int [optional]</span>
<span class="sd">        Supply this to access specific station deployment data.</span>
<span class="sd">        Must be &gt;= 1.</span>
<span class="sd">    data_dir : str [optional]</span>
<span class="sd">        Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">        of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="n">active_state_key</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_default</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.ActiveXY" class="doc doc-heading">
            <code>ActiveXY</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Archive (cdippy.cdipnc.Archive)" href="#cdippy.cdipnc.Archive">Archive</a></code></p>


        <p>Loads an "active" (predeploy, moored, offsite, recovered) xy nc file
for the given station and deployment.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ActiveXY</span><span class="p">(</span><span class="n">Archive</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads an &quot;active&quot; (predeploy, moored, offsite, recovered) xy nc file</span>
<span class="sd">    for the given station and deployment.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PARAMETERS</span>
<span class="sd">            ----------</span>
<span class="sd">            dataset : str</span>
<span class="sd">                Active dataset name.</span>
<span class="sd">                Values are: predeploy|moored|offsite|recovered.</span>
<span class="sd">            For other parameters see CDIPnc.set_dataset_info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="n">dataset</span> <span class="o">+</span> <span class="s2">&quot;xy&quot;</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_default</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.ActiveXY.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>PARAMETERS
    ----------
    dataset : str
        Active dataset name.
        Values are: predeploy|moored|offsite|recovered.
    For other parameters see CDIPnc.set_dataset_info.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : str</span>
<span class="sd">            Active dataset name.</span>
<span class="sd">            Values are: predeploy|moored|offsite|recovered.</span>
<span class="sd">        For other parameters see CDIPnc.set_dataset_info.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="n">dataset</span> <span class="o">+</span> <span class="s2">&quot;xy&quot;</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_default</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.Archive" class="doc doc-heading">
            <code>Archive</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CDIPnc (cdippy.cdipnc.CDIPnc)" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a></code></p>


        <p>Loads an archive (deployment) file for a given station and deployment.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Archive</span><span class="p">(</span><span class="n">CDIPnc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads an archive (deployment) file for a given station and deployment.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">deployment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For parameters see CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>
        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deployment</span><span class="p">:</span>
            <span class="n">deployment</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_idx_from_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzStartTime&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzSampleRate&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Mark I will have filter delay set to fill value</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzFilterDelay&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">d</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__make_xyzTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzStartTime&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzSampleRate&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1"># Mark I will have filter delay set to fill value</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzFilterDelay&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">t0</span> <span class="o">-</span> <span class="n">d</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="n">r</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_xyz_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyzIndex</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the timestamp corresponding to the given xyz array index.&quot;&quot;&quot;</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzStartTime&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzSampleRate&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Mark I will have filter delay set to fill value</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzFilterDelay&quot;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t0</span> <span class="ow">and</span> <span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t0</span> <span class="o">-</span> <span class="n">d</span> <span class="o">+</span> <span class="n">xyzIndex</span> <span class="o">/</span> <span class="n">r</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Overrides the base class method to handle xyz data requests.&quot;&quot;&quot;</span>

        <span class="c1"># If not an xyz request, use base class version</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;xyz&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Archive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

        <span class="c1"># xyzData is shorthand for all these vars</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;xyzData&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xyzXDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzYDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">]</span>

        <span class="c1"># Handle the xyz request</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_idx_from_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_idx_from_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">)</span>
        <span class="c1"># Find out if the request timespan overlaps the data</span>
        <span class="n">ts1</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
        <span class="n">ts2</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ts1</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">ts2</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="c1"># Make sure the indices will work with the arrays</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">)</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
        <span class="c1"># Just calculate xyz times for the good indices</span>
        <span class="n">xyzTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_xyzTime</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xyzTime&quot;</span><span class="p">:</span> <span class="n">xyzTime</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">vname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">vname</span><span class="p">)[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Archive.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">deployment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>For parameters see CDIPnc.set_dataset_info.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">deployment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For parameters see CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>
    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">deployment</span><span class="p">:</span>
        <span class="n">deployment</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">,</span> <span class="n">deployment</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Archive.get_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_request</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Overrides the base class method to handle xyz data requests.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Overrides the base class method to handle xyz data requests.&quot;&quot;&quot;</span>

    <span class="c1"># If not an xyz request, use base class version</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="s2">&quot;xyz&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Archive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

    <span class="c1"># xyzData is shorthand for all these vars</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;xyzData&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xyzXDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzYDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">]</span>

    <span class="c1"># Handle the xyz request</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_idx_from_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">)</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_idx_from_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">)</span>
    <span class="c1"># Find out if the request timespan overlaps the data</span>
    <span class="n">ts1</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
    <span class="n">ts2</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ts1</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">ts2</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{}</span>
    <span class="c1"># Make sure the indices will work with the arrays</span>
    <span class="n">start_idx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">start_idx</span><span class="p">)</span>
    <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
    <span class="c1"># Just calculate xyz times for the good indices</span>
    <span class="n">xyzTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_xyzTime</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xyzTime&quot;</span><span class="p">:</span> <span class="n">xyzTime</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">vname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">:</span>
        <span class="n">result</span><span class="p">[</span><span class="n">vname</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">vname</span><span class="p">)[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Archive.get_xyz_timestamp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_xyz_timestamp</span><span class="p">(</span><span class="n">xyzIndex</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the timestamp corresponding to the given xyz array index.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_xyz_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyzIndex</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the timestamp corresponding to the given xyz array index.&quot;&quot;&quot;</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzStartTime&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzSampleRate&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Mark I will have filter delay set to fill value</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzFilterDelay&quot;</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span> <span class="k">else</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">t0</span> <span class="ow">and</span> <span class="n">r</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">t0</span> <span class="o">-</span> <span class="n">d</span> <span class="o">+</span> <span class="n">xyzIndex</span> <span class="o">/</span> <span class="n">r</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.CDIPnc" class="doc doc-heading">
            <code>CDIPnc</code>


</h3>


    <div class="doc doc-contents ">


        <p>A base class used by the class StnData for retrieving data from
CDIP netCDF (nc) files located either locally or remotely.</p>
<p>Files accessed remotely are served by CDIP's THREDDS server.
Files accessed locally need to be located within a specific
directory hierarchy.</p>
<p>For each CDIP nc file "type" such as historic.nc or archive.nc,
there is a corresponding sub-class, e.g. Historic or Archive.
Although the constructors of these classes can be used to access
data, StnData is recommended because it seamlessly combines
records across multiple files.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CDIPnc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A base class used by the class StnData for retrieving data from</span>
<span class="sd">    CDIP netCDF (nc) files located either locally or remotely.</span>

<span class="sd">    Files accessed remotely are served by CDIP&#39;s THREDDS server.</span>
<span class="sd">    Files accessed locally need to be located within a specific</span>
<span class="sd">    directory hierarchy.</span>

<span class="sd">    For each CDIP nc file &quot;type&quot; such as historic.nc or archive.nc,</span>
<span class="sd">    there is a corresponding sub-class, e.g. Historic or Archive.</span>
<span class="sd">    Although the constructors of these classes can be used to access</span>
<span class="sd">    data, StnData is recommended because it seamlessly combines</span>
<span class="sd">    records across multiple files.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">THREDDS_url</span> <span class="o">=</span> <span class="s2">&quot;https://thredds.cdip.ucsd.edu&quot;</span>
    <span class="n">dods</span> <span class="o">=</span> <span class="s2">&quot;thredds/dodsC&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># - Load_stn_nc_files only checks for this number of deployments</span>
    <span class="n">max_deployments</span> <span class="o">=</span> <span class="mi">99</span>

    <span class="c1"># - Top level data dir for nc files. Files must be within subdirectories:</span>
    <span class="c1"># - i.e. &lt;data_dir&gt;/REALTIME, &lt;data_dir&gt;/ARCHIVE/201p1</span>
    <span class="n">data_dir</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># DATA QUALITY FLAGS AND PUBLIC/NONPUB</span>
    <span class="c1">#</span>
    <span class="c1"># waveFlagPrimary (WFP): 1-good, 2-not_evaluated, 3-questionable, 4-bad, 9-missing</span>
    <span class="c1"># waveFlagSecondary (WFS): 0-unspecified, 1-sensor issues, 2... are specific messages e.g. Hs out of bounds</span>
    <span class="c1">#</span>
    <span class="c1"># Data for public release is distinguished by WFP=1 and found in all nc files.</span>
    <span class="c1"># Data not for public release is distinguished by WFP=4 and found in all files except historic.nc</span>
    <span class="c1">#</span>
    <span class="c1"># There are cases where WFP=1 and WFS!=0 - e.g. if frequency bands have been reformatted.</span>
    <span class="c1"># Records with WFP=4 are not necessarily bad data.</span>
    <span class="c1"># All xy records are flagged WFP=2 - not_evaluated.</span>
    <span class="c1">#</span>
    <span class="c1"># NC files: latest, pre-deploy, moored, offsite, recovered, historic, archive</span>
    <span class="c1">#</span>
    <span class="n">pub_set_default</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span>
    <span class="c1"># Dashed tags such as public-good are for backwards compatibility</span>
    <span class="n">pub_set_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;public&quot;</span><span class="p">:</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nonpub&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpub&quot;</span><span class="p">,</span>
        <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="s2">&quot;public-good&quot;</span><span class="p">:</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nonpub-all&quot;</span><span class="p">:</span> <span class="s2">&quot;nonpub&quot;</span><span class="p">,</span>
        <span class="s2">&quot;both-all&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Applies the mask before data is returned</span>
    <span class="n">apply_mask</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Active datasets - deployments that span NOW</span>
    <span class="n">active_datasets</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;predeploy&quot;</span><span class="p">:</span> <span class="s2">&quot;p0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;moored&quot;</span><span class="p">:</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;offsite&quot;</span><span class="p">:</span> <span class="s2">&quot;p2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;recovered&quot;</span><span class="p">:</span> <span class="s2">&quot;p3&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Spectral layout. For each dataset we need to determine if it is mk3 (64 bands)</span>
    <span class="c1"># or mk4 (100 bands) spectral layout. Prior to aggregation, if 1 dataset is mk3,</span>
    <span class="c1"># all spectral layouts must be converted to mk3 during aggregation.</span>
    <span class="n">spectral_layout</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># REQUESTING DATA PROCEDURE</span>
    <span class="c1">#</span>
    <span class="c1"># HOW TO USE</span>
    <span class="c1"># 1. call set_request_info</span>
    <span class="c1"># 2. call get_request</span>
    <span class="c1">#</span>
    <span class="c1"># HOW IT WORKS</span>
    <span class="c1"># 1. For a given set of variables of the same type (e.g. &#39;wave&#39;),</span>
    <span class="c1">#   a. determine the dimension var name and if it is a time dimension</span>
    <span class="c1">#   b. determine the ancillary variable name (e.g. &#39;waveFlagPrimary&#39;), if it exists</span>
    <span class="c1"># 2. If the dimension is a time dimension, find the start and end indices based on the query</span>
    <span class="c1">#    (Use start and end indices to subset all variables henceforth)</span>
    <span class="c1"># 3. Create an ancillary variable mask based on the pub set (and start, end indices if applicable)</span>
    <span class="c1"># 4. For each variable,</span>
    <span class="c1">#    a. use start, end indices to create a masked array</span>
    <span class="c1">#    b. union the variable&#39;s mask with the ancillary mask</span>
    <span class="c1">#    c. set the new masked array variable&#39;s mask to the union mask</span>
    <span class="c1"># 5. Apply the mask if self.apply_mask set True.</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        data_dir : str [optional]</span>
<span class="sd">            Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">            of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">        deployment : int [optional]</span>
<span class="sd">            Supply this to access specific station deployment data.</span>
<span class="sd">            Must be &gt;= 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">=</span> <span class="n">deployment</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_request_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vrs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveHs&quot;</span><span class="p">],</span>
        <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
        <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes data request information for get_request.</span>

<span class="sd">        PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        start : str or datetime [optional] : default Jan 1, 1975</span>
<span class="sd">            Start time of data request (UTC). If provided as a string must</span>
<span class="sd">            be in the format Y-m-d H:M:S where Y is 4 chars and all others</span>
<span class="sd">            are 2 chars. Ex. &#39;2020-03-30 19:32:56&#39;.</span>
<span class="sd">        end : str or datetime [optional] : default now</span>
<span class="sd">            End time of data request (UTC). If not supplied defaults to now.</span>
<span class="sd">        vrs : list [optional] : default [&#39;waveHs&#39;]</span>
<span class="sd">            A list of the names of variables to retrieve. They all must start</span>
<span class="sd">            with the same prefix, e.g. [&#39;waveHs&#39;, &#39;waveTp&#39;, &#39;waveDp&#39;]</span>
<span class="sd">        pub_set: str [optional] values = public|nonpub|all</span>
<span class="sd">            Filters data based on data quality flags.</span>
<span class="sd">        apply_mask: bool [optional] default True</span>
<span class="sd">            Removes values from the masked array that have a mask value of True.</span>
<span class="sd">            Ex. If nonpub data is requested and apply_mask is False, the returned</span>
<span class="sd">            array will contain both public and nonpublic data (although public</span>
<span class="sd">            data records will have the mask value set to True). If apply_mask</span>
<span class="sd">            is set to True, only nonpub records will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_timespan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pub_set</span><span class="p">(</span><span class="n">pub_set</span><span class="p">)</span>  <span class="c1"># Standardize the set name</span>
        <span class="k">if</span> <span class="n">apply_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="n">apply_mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="n">vrs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_timespan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets request timespan&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_dt</span> <span class="o">=</span> <span class="n">start</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_dt</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_dt</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_dt</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the data specified using set_request_info.</span>

<span class="sd">        RETURNS</span>
<span class="sd">        -------</span>
<span class="sd">        A dictionary containing keys of the requested variables each</span>
<span class="sd">        of which is a numpy masked array of data values. In addition,</span>
<span class="sd">        the time values are returned as well. For example, if waveHs</span>
<span class="sd">        was requested, the dictionary will look like this:</span>
<span class="sd">        {&#39;waveHs&#39;: &lt;np.masked_array&gt;, &#39;waveTime&#39;: &lt;np.masked_array&gt;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mask_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">save</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># - Check if requested variable 0 exists</span>
        <span class="n">first_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">first_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Use first var to determine the dimension, grab it and find indices</span>
        <span class="n">time_dim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">dim_name</span> <span class="ow">in</span> <span class="n">first_var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
            <span class="n">nc_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nc_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># To handle non-existing &quot;count&quot; variables</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">nc_var</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;seconds&quot;</span><span class="p">:</span>
                <span class="n">time_dim</span> <span class="o">=</span> <span class="n">dim_name</span>
                <span class="c1"># dim_data = np.ma.asarray(self.nc.variables[dim_name][:])</span>
                <span class="n">dim_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">nc_var</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nc_var</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
                <span class="c1"># - find time dimension start and end indices</span>
                <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_indices</span><span class="p">(</span>
                    <span class="n">dim_data</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">s_idx</span> <span class="o">==</span> <span class="n">e_idx</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span>
                <span class="n">mask_results</span><span class="p">[</span><span class="n">time_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim_data</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># E.g. waveFrequency (Do I want to add to result?</span>
                <span class="n">save</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>

        <span class="c1"># Grab the time subset of each variable</span>
        <span class="k">for</span> <span class="n">v_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">v_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">v_name</span> <span class="o">==</span> <span class="s2">&quot;metaStationName&quot;</span><span class="p">:</span>
                <span class="c1"># Use existing byte_arr_to_string method for station name</span>
                <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">v_name</span><span class="p">][:])</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;maxStrlen64&quot;</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">v_name</span><span class="p">][:]</span>
                <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">time_dim</span><span class="p">:</span>
                <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># !!! This could be a problem for 2-d arrays. Specifying end</span>
                <span class="c1"># index too large may reshape array?</span>
                <span class="c1">#</span>
                <span class="c1"># Also, there seems to be a bug for single values such as</span>
                <span class="c1"># metaWaterDepth in realtime files. Those variables have</span>
                <span class="c1"># no shape (shape is an empty tupble) and len(v) bombs even</span>
                <span class="c1"># though v[:] returns an array with one value.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">v_len</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v_len</span><span class="p">)</span>

        <span class="c1"># Use first var to determine the ancillary variable, e.g. waveFlagPrimary</span>
        <span class="c1"># If there is an ancillary variable, use pub/nonpub to create a mask</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">first_var</span><span class="p">,</span> <span class="s2">&quot;ancillary_variables&quot;</span><span class="p">):</span>
            <span class="n">anc_names</span> <span class="o">=</span> <span class="n">first_var</span><span class="o">.</span><span class="n">ancillary_variables</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">anc_name</span> <span class="o">=</span> <span class="n">anc_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Create the variable mask using pub/nonpub choice</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">time_dim</span><span class="p">:</span>
                <span class="n">s_idx</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">anc_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pub_mask</span><span class="p">(</span><span class="n">anc_name</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">anc_mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Still a problem. 2-d vars.</span>
        <span class="c1"># Seems to work if the variable has no mask set. But</span>
        <span class="c1"># if mask set, returns 1-d var.</span>
        <span class="k">for</span> <span class="n">v_name</span> <span class="ow">in</span> <span class="n">mask_results</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span> <span class="ow">and</span> <span class="n">anc_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span>
                <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">~</span><span class="n">anc_mask</span><span class="p">]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__make_masked_array</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">nc_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a numpy masked array for a given nc variable and indices.</span>

<span class="sd">        e_idx is appropriate for python arrays. I.e. one more than last index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">,</span> <span class="p">:])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">,</span> <span class="p">:])</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_pub_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anc_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an np.ndarray of bools given pub_set and ancillary var&quot;&quot;&quot;</span>

        <span class="c1"># No s_idx, use whole array. Otherwise time subset the anc var.</span>
        <span class="n">nc_primary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">anc_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">e_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_primary</span><span class="p">)</span>
        <span class="n">primary_flag_values</span> <span class="o">=</span> <span class="n">nc_primary</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;waveFrequencyFlagPrimary&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Not sure about this one</span>
        <span class="k">elif</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;gpsStatusFlags&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">primary_flag_values</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span>
            <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;waveFlagPrimary&quot;</span>
            <span class="ow">or</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;sstFlagPrimary&quot;</span>
            <span class="ow">or</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;acmFlagPrimary&quot;</span>
            <span class="ow">or</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;cat4FlagPrimary&quot;</span>
        <span class="p">):</span>
            <span class="n">public_mask</span> <span class="o">=</span> <span class="n">primary_flag_values</span> <span class="o">!=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;xyzFlagPrimary&quot;</span><span class="p">:</span>
            <span class="n">public_mask</span> <span class="o">=</span> <span class="n">primary_flag_values</span> <span class="o">!=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;public&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">public_mask</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;nonpub&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="o">~</span><span class="n">public_mask</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">primary_flag_values</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_pub_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns either &#39;public&#39;, &#39;nonpub&#39; or &#39;all&#39;.</span>

<span class="sd">        Maintains backwards compatibility with prior pub_set names.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_var_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns &#39;wave&#39; part of the string &#39;waveHs&#39;.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
                <span class="k">break</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_flag_meanings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns flag category values and meanings given a flag_name.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span><span class="o">.</span><span class="n">flag_meanings</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_flag_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns flag category values and meanings given a flag_name.&quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">flag_masks</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">flag_values</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_date_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the time the nc file was last modified.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">date_modified</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_coverage_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the start time of the nc file data coverage.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_coverage_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the end time of the nc file data coverage.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">time_coverage_end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">start_stamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_stamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns start and end indices to include any times that are equal to start_stamp or end_stamp.&quot;&quot;&quot;</span>
        <span class="n">s_idx</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">start_stamp</span><span class="p">)</span>  <span class="c1"># Will include time if equal</span>
        <span class="c1"># Will give e_idx appropriate for python arrays</span>
        <span class="n">e_idx</span> <span class="o">=</span> <span class="n">bisect_right</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">end_stamp</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">retry</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Try again if unsuccessful (nc file not ready? THREDDS problem?)</span>
            <span class="k">if</span> <span class="n">retry</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Retrying to open dataset at </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> due to an unexpected exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
                <span class="n">msg</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to open dataset at </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2"> due to an unexpected exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">byte_arr_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b_arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">b_arr</span><span class="p">):</span>
            <span class="n">b_arr</span> <span class="o">=</span> <span class="n">b_arr</span><span class="p">[</span><span class="o">~</span><span class="n">b_arr</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">b_arr</span><span class="p">[:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="n">c</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaStationName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the metaStationName.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaStationName&quot;</span><span class="p">][:])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if a variable exists then returns a pointer to it.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dict of two lists of urls (or paths) to all CDIP station datasets.</span>

<span class="sd">        The top level keys are &#39;realtime&#39; and &#39;historic&#39;. The urls are retrieved by</span>
<span class="sd">        either descending into the THREDDS catalog.xml or recursively walking through data_dir sub</span>
<span class="sd">        directories.</span>

<span class="sd">        For applications that need to use the data from multiple deployment files for</span>
<span class="sd">        a station, stndata:get_nc_files will load those files efficiently.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;realtime&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;archive&quot;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="c1"># - Walk through data_dir sub dirs</span>
            <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dirpath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;REALTIME&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.nc&quot;</span><span class="p">:</span>
                            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;realtime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">dirpath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ARCHIVE&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.nc&quot;</span><span class="p">:</span>
                            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;archive&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">catalog_url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="s2">&quot;thredds&quot;</span><span class="p">,</span> <span class="s2">&quot;catalog.xml&quot;</span><span class="p">])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">catalog_url</span><span class="p">)</span>
        <span class="n">catalogs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">catalogs</span><span class="p">,</span> <span class="s2">&quot;catalogRef&quot;</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">catalog</span> <span class="ow">in</span> <span class="n">catalogs</span><span class="p">:</span>
            <span class="c1"># - Archive data sets</span>
            <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span> <span class="o">+</span> <span class="n">catalog</span>
            <span class="n">cat</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">catalog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;archive&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ar_urls</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">ar_urls</span><span class="p">,</span> <span class="s2">&quot;catalogRef&quot;</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
                <span class="n">b_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="c1"># - Station datasets</span>
                <span class="n">ar_ds_urls</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ar_urls</span><span class="p">:</span>
                    <span class="n">url</span> <span class="o">=</span> <span class="n">b_url</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">u</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                    <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ar_ds_urls</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;urlPath&quot;</span><span class="p">)</span>
                <span class="n">full_urls</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">ar_ds_urls</span><span class="p">:</span>
                    <span class="n">full_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="s2">&quot;cdip&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="mi">5</span><span class="p">:]])</span>
                    <span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;archive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_urls</span>
            <span class="k">elif</span> <span class="n">catalog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;realtime&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rt_ds_urls</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">rt_ds_urls</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;urlPath&quot;</span><span class="p">)</span>
                <span class="n">full_urls</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">rt_ds_urls</span><span class="p">:</span>
                    <span class="n">full_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="s2">&quot;cdip&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="mi">5</span><span class="p">:]])</span>
                    <span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;realtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_urls</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_dataset_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets self.stn, org, filename, url and loads self.nc. The key to understanding all of</span>
<span class="sd">        this is that we are ultimately setting _url_, which can be an actual path to the</span>
<span class="sd">        nc file or a url to THREDDS DoDS service.</span>

<span class="sd">        PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        stn : str</span>
<span class="sd">           Can be in 3char (e.g. 028) or 5char (e.g. 028p2) format for org=cdip</span>
<span class="sd">        org: str</span>
<span class="sd">            (Organization) Values are: cdip|ww3|external</span>
<span class="sd">        dataset_name : str</span>
<span class="sd">            Values: realtime|historic|archive|realtimexy|archivexy|</span>
<span class="sd">                    predeploy|moored|offsite|recovered</span>
<span class="sd">        deployment : int [optional]</span>
<span class="sd">            Supply this to access specific station deployment data.</span>
<span class="sd">            Must be &gt;= 1.</span>

<span class="sd">        Paths are:</span>
<span class="sd">            &lt;top_dir&gt;/EXTERNAL/WW3/&lt;filename&gt;  [filename=&lt;stn&gt;_&lt;org_dir&gt;_&lt;dataset_name&gt;.nc][CDIP stn like 192w3]</span>
<span class="sd">            &lt;top_dir&gt;/REALTIME/&lt;filename&gt; [filename=&lt;stn&gt;&lt;p1&gt;_rt.nc]</span>
<span class="sd">            &lt;top_dir&gt;/REALTIME/&lt;filename&gt; [filename=&lt;stn&gt;&lt;p1&gt;_xy.nc]</span>
<span class="sd">            &lt;top_dir&gt;/ARCHIVE/&lt;stn&gt;/&lt;filename&gt; [filename=&lt;stn3&gt;&lt;p1&gt;_&lt;deployment&gt;.nc]</span>
<span class="sd">            &lt;top_dir&gt;/PREDEPLOY/&lt;stn&gt;/&lt;filename&gt; [filename=&lt;stn3&gt;&lt;pX&gt;_&lt;deployment&gt;_rt.nc]**</span>
<span class="sd">            &lt;top_dir&gt;/PREDEPLOY/&lt;stn&gt;/&lt;filename&gt; [filename=&lt;stn3&gt;&lt;pX&gt;_&lt;deployment&gt;_xy.nc]**</span>

<span class="sd">            **Active deployment directories are PREDEPLOY (p0), MOORED (p1), OFFSITE (p2)  and RECOVERED (p3)</span>
<span class="sd">              pX = p0|p1|p2|p3; deployment = dXX e.g. d01</span>

<span class="sd">        Urls are:</span>
<span class="sd">            http://thredds.cdip.ucsd/thredds/dodsC/&lt;org1&gt;/&lt;org_dir&gt;/&lt;filename&gt;</span>
<span class="sd">               [org1=external|cdip,org_dir=WW3|OWI etc]</span>
<span class="sd">            http://thredds.cdip.ucsd/thredds/dodsC/&lt;org1&gt;/&lt;dataset_name&gt;/&lt;filename&gt;</span>

<span class="sd">            Note:</span>
<span class="sd">               Since adding dataset_name, we no longer need the 5char stn id</span>
<span class="sd">               for org=cdip datasets. The p_val will be &#39;p1&#39; for every dataset except</span>
<span class="sd">               active datasets in buoy states predeploy (p0), offsite (p2) and recovered (p3).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.nc&quot;</span>

        <span class="c1"># Allowing data_dir to be either url or path</span>
        <span class="n">__using_path</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;http&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">__using_path</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">org</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">org</span> <span class="o">=</span> <span class="s2">&quot;cdip&quot;</span>
        <span class="k">if</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;cdip&quot;</span><span class="p">:</span>
            <span class="n">org1</span> <span class="o">=</span> <span class="s2">&quot;cdip&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">org1</span> <span class="o">=</span> <span class="s2">&quot;external&quot;</span>
        <span class="c1"># Org_dir follows &#39;external&#39; and always uppercase (isn&#39;t used when org is cdip)</span>
        <span class="n">org_dir</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="c1"># Handle the xy datasets</span>
        <span class="k">if</span> <span class="s2">&quot;xy&quot;</span> <span class="ow">in</span> <span class="n">dataset_name</span><span class="p">:</span>
            <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;xy&quot;</span>
            <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;rt&quot;</span>

        <span class="c1"># Historic and archive both use archive as a dataset_dir</span>
        <span class="c1"># Lowercase for url, uppercase for url</span>
        <span class="k">if</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;historic&quot;</span><span class="p">:</span>
            <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;archive&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">dataset_name</span>

        <span class="c1"># Local paths use uppercase</span>
        <span class="k">if</span> <span class="n">__using_path</span><span class="p">:</span>
            <span class="n">org1</span> <span class="o">=</span> <span class="n">org1</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">dataset_dir</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;cdip&quot;</span><span class="p">:</span>
                <span class="n">url_pre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">url_pre</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">org1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_pre</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="n">org1</span><span class="p">])</span>

        <span class="c1"># Set p_val to &#39;p1&#39; - it will get changed appropriately below</span>
        <span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;p1&quot;</span>

        <span class="c1"># Make filename and url</span>
        <span class="k">if</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;cdip&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">deployment</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_datasets</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
                <span class="n">dataset_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">deployment</span><span class="p">,</span> <span class="n">ftype</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;realtime&quot;</span><span class="p">:</span>
                <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">ftype</span>
            <span class="k">elif</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;historic&quot;</span><span class="p">:</span>
                <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">stn</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;archive&quot;</span> <span class="ow">and</span> <span class="n">deployment</span><span class="p">:</span>
                <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">deployment</span>
                <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">stn</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">stn</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">url_pre</span><span class="p">,</span> <span class="n">dataset_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span> <span class="ow">and</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;ww3&quot;</span><span class="p">:</span>  <span class="c1"># Cdip stn id</span>
                <span class="n">stn_tmp</span> <span class="o">=</span> <span class="n">ndbc</span><span class="o">.</span><span class="n">get_wmo_id</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stn_tmp</span> <span class="o">=</span> <span class="n">stn</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">stn_tmp</span><span class="p">,</span> <span class="n">org_dir</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">url_pre</span><span class="p">,</span> <span class="n">org_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">org</span> <span class="o">=</span> <span class="n">org</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.__get_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__get_indices</span><span class="p">(</span><span class="n">times</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">start_stamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_stamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns start and end indices to include any times that are equal to start_stamp or end_stamp.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">start_stamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">end_stamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns start and end indices to include any times that are equal to start_stamp or end_stamp.&quot;&quot;&quot;</span>
    <span class="n">s_idx</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">start_stamp</span><span class="p">)</span>  <span class="c1"># Will include time if equal</span>
    <span class="c1"># Will give e_idx appropriate for python arrays</span>
    <span class="n">e_idx</span> <span class="o">=</span> <span class="n">bisect_right</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">end_stamp</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <h6 id="cdippy.cdipnc.CDIPnc.__init__--parameters">PARAMETERS</h6>
<p>data_dir : str [optional]
    Either a full path to a directory containing a local directory hierarchy
    of nc files. E.g. '/project/WNC' or a url to a THREDDS server.
deployment : int [optional]
    Supply this to access specific station deployment data.
    Must be &gt;= 1.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    data_dir : str [optional]</span>
<span class="sd">        Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">        of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">    deployment : int [optional]</span>
<span class="sd">        Supply this to access specific station deployment data.</span>
<span class="sd">        Must be &gt;= 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deployment</span> <span class="o">=</span> <span class="n">deployment</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.__make_masked_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">nc_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a numpy masked array for a given nc variable and indices.</p>
<p>e_idx is appropriate for python arrays. I.e. one more than last index.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__make_masked_array</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">nc_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a numpy masked array for a given nc variable and indices.</span>

<span class="sd">    e_idx is appropriate for python arrays. I.e. one more than last index.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_var</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nc_var</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">,</span> <span class="p">:])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_coverage_end" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_coverage_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">datetime</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the end time of the nc file data coverage.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_coverage_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the end time of the nc file data coverage.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">time_coverage_end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_coverage_start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_coverage_start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">datetime</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the start time of the nc file data coverage.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_coverage_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the start time of the nc file data coverage.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">time_coverage_start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_dataset_urls" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dataset_urls</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a dict of two lists of urls (or paths) to all CDIP station datasets.</p>
<p>The top level keys are 'realtime' and 'historic'. The urls are retrieved by
either descending into the THREDDS catalog.xml or recursively walking through data_dir sub
directories.</p>
<p>For applications that need to use the data from multiple deployment files for
a station, stndata:get_nc_files will load those files efficiently.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_dataset_urls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dict of two lists of urls (or paths) to all CDIP station datasets.</span>

<span class="sd">    The top level keys are &#39;realtime&#39; and &#39;historic&#39;. The urls are retrieved by</span>
<span class="sd">    either descending into the THREDDS catalog.xml or recursively walking through data_dir sub</span>
<span class="sd">    directories.</span>

<span class="sd">    For applications that need to use the data from multiple deployment files for</span>
<span class="sd">    a station, stndata:get_nc_files will load those files efficiently.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;realtime&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;archive&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="c1"># - Walk through data_dir sub dirs</span>
        <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dirpath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;REALTIME&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.nc&quot;</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;realtime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">dirpath</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ARCHIVE&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;.nc&quot;</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;archive&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">catalog_url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="s2">&quot;thredds&quot;</span><span class="p">,</span> <span class="s2">&quot;catalog.xml&quot;</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">catalog_url</span><span class="p">)</span>
    <span class="n">catalogs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">catalogs</span><span class="p">,</span> <span class="s2">&quot;catalogRef&quot;</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">catalog</span> <span class="ow">in</span> <span class="n">catalogs</span><span class="p">:</span>
        <span class="c1"># - Archive data sets</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span> <span class="o">+</span> <span class="n">catalog</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">catalog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;archive&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ar_urls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">ar_urls</span><span class="p">,</span> <span class="s2">&quot;catalogRef&quot;</span><span class="p">,</span> <span class="s2">&quot;href&quot;</span><span class="p">)</span>
            <span class="n">b_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="c1"># - Station datasets</span>
            <span class="n">ar_ds_urls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">ar_urls</span><span class="p">:</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">b_url</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">u</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ar_ds_urls</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;urlPath&quot;</span><span class="p">)</span>
            <span class="n">full_urls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">ar_ds_urls</span><span class="p">:</span>
                <span class="n">full_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="s2">&quot;cdip&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="mi">5</span><span class="p">:]])</span>
                <span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;archive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_urls</span>
        <span class="k">elif</span> <span class="n">catalog</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;realtime&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rt_ds_urls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindta</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">rt_ds_urls</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;urlPath&quot;</span><span class="p">)</span>
            <span class="n">full_urls</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">rt_ds_urls</span><span class="p">:</span>
                <span class="n">full_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="s2">&quot;cdip&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">[</span><span class="mi">5</span><span class="p">:]])</span>
                <span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;realtime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_urls</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_date_modified" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_date_modified</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">datetime</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the time the nc file was last modified.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_date_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the time the nc file was last modified.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">date_modified</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_flag_meanings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_flag_meanings</span><span class="p">(</span><span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns flag category values and meanings given a flag_name.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_flag_meanings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns flag category values and meanings given a flag_name.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span><span class="o">.</span><span class="n">flag_meanings</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_flag_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_flag_values</span><span class="p">(</span><span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns flag category values and meanings given a flag_name.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_flag_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns flag category values and meanings given a flag_name.&quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">flag_masks</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">flag_values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_pub_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_pub_set</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns either 'public', 'nonpub' or 'all'.</p>
<p>Maintains backwards compatibility with prior pub_set names.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_pub_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns either &#39;public&#39;, &#39;nonpub&#39; or &#39;all&#39;.</span>

<span class="sd">    Maintains backwards compatibility with prior pub_set names.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_default</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set_map</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_request</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the data specified using set_request_info.</p>
<h6 id="cdippy.cdipnc.CDIPnc.get_request--returns">RETURNS</h6>
<p _waveHs_:="'waveHs':" _waveTime_:="'waveTime':" _wzxhzdk:0_="<np.masked_array>," _wzxhzdk:1_="<np.masked_array>">A dictionary containing keys of the requested variables each
of which is a numpy masked array of data values. In addition,
the time values are returned as well. For example, if waveHs
was requested, the dictionary will look like this:</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_request</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the data specified using set_request_info.</span>

<span class="sd">    RETURNS</span>
<span class="sd">    -------</span>
<span class="sd">    A dictionary containing keys of the requested variables each</span>
<span class="sd">    of which is a numpy masked array of data values. In addition,</span>
<span class="sd">    the time values are returned as well. For example, if waveHs</span>
<span class="sd">    was requested, the dictionary will look like this:</span>
<span class="sd">    {&#39;waveHs&#39;: &lt;np.masked_array&gt;, &#39;waveTime&#39;: &lt;np.masked_array&gt;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">save</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># - Check if requested variable 0 exists</span>
    <span class="n">first_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">first_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Use first var to determine the dimension, grab it and find indices</span>
    <span class="n">time_dim</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">dim_name</span> <span class="ow">in</span> <span class="n">first_var</span><span class="o">.</span><span class="n">dimensions</span><span class="p">:</span>
        <span class="n">nc_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">dim_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nc_var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># To handle non-existing &quot;count&quot; variables</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">nc_var</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;seconds&quot;</span><span class="p">:</span>
            <span class="n">time_dim</span> <span class="o">=</span> <span class="n">dim_name</span>
            <span class="c1"># dim_data = np.ma.asarray(self.nc.variables[dim_name][:])</span>
            <span class="n">dim_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">nc_var</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nc_var</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="c1"># - find time dimension start and end indices</span>
            <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_indices</span><span class="p">(</span>
                <span class="n">dim_data</span><span class="p">[:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">s_idx</span> <span class="o">==</span> <span class="n">e_idx</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="n">mask_results</span><span class="p">[</span><span class="n">time_dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">dim_data</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># E.g. waveFrequency (Do I want to add to result?</span>
            <span class="n">save</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">dim_name</span><span class="p">]</span>

    <span class="c1"># Grab the time subset of each variable</span>
    <span class="k">for</span> <span class="n">v_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">v_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">v_name</span> <span class="o">==</span> <span class="s2">&quot;metaStationName&quot;</span><span class="p">:</span>
            <span class="c1"># Use existing byte_arr_to_string method for station name</span>
            <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">v_name</span><span class="p">][:])</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;maxStrlen64&quot;</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">v_name</span><span class="p">][:]</span>
            <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">time_dim</span><span class="p">:</span>
            <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># !!! This could be a problem for 2-d arrays. Specifying end</span>
            <span class="c1"># index too large may reshape array?</span>
            <span class="c1">#</span>
            <span class="c1"># Also, there seems to be a bug for single values such as</span>
            <span class="c1"># metaWaterDepth in realtime files. Those variables have</span>
            <span class="c1"># no shape (shape is an empty tupble) and len(v) bombs even</span>
            <span class="c1"># though v[:] returns an array with one value.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">v_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">v_len</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__make_masked_array</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v_len</span><span class="p">)</span>

    <span class="c1"># Use first var to determine the ancillary variable, e.g. waveFlagPrimary</span>
    <span class="c1"># If there is an ancillary variable, use pub/nonpub to create a mask</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">first_var</span><span class="p">,</span> <span class="s2">&quot;ancillary_variables&quot;</span><span class="p">):</span>
        <span class="n">anc_names</span> <span class="o">=</span> <span class="n">first_var</span><span class="o">.</span><span class="n">ancillary_variables</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">anc_name</span> <span class="o">=</span> <span class="n">anc_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Create the variable mask using pub/nonpub choice</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_dim</span><span class="p">:</span>
            <span class="n">s_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">anc_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pub_mask</span><span class="p">(</span><span class="n">anc_name</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">anc_mask</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Still a problem. 2-d vars.</span>
    <span class="c1"># Seems to work if the variable has no mask set. But</span>
    <span class="c1"># if mask set, returns 1-d var.</span>
    <span class="k">for</span> <span class="n">v_name</span> <span class="ow">in</span> <span class="n">mask_results</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span> <span class="ow">and</span> <span class="n">anc_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span>
            <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">~</span><span class="n">anc_mask</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_results</span><span class="p">[</span><span class="n">v_name</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_var" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_var</span><span class="p">(</span><span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Checks if a variable exists then returns a pointer to it.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if a variable exists then returns a pointer to it.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.get_var_prefix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns 'wave' part of the string 'waveHs'.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_var_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns &#39;wave&#39; part of the string &#39;waveHs&#39;.&quot;&quot;&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">var_name</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="k">break</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="k">return</span> <span class="n">s</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.make_pub_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_pub_mask</span><span class="p">(</span><span class="n">anc_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns an np.ndarray of bools given pub_set and ancillary var</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_pub_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anc_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">s_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">e_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns an np.ndarray of bools given pub_set and ancillary var&quot;&quot;&quot;</span>

    <span class="c1"># No s_idx, use whole array. Otherwise time subset the anc var.</span>
    <span class="n">nc_primary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">anc_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s_idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">e_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_primary</span><span class="p">)</span>
    <span class="n">primary_flag_values</span> <span class="o">=</span> <span class="n">nc_primary</span><span class="p">[</span><span class="n">s_idx</span><span class="p">:</span><span class="n">e_idx</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;waveFrequencyFlagPrimary&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># Not sure about this one</span>
    <span class="k">elif</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;gpsStatusFlags&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">primary_flag_values</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span>
        <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;waveFlagPrimary&quot;</span>
        <span class="ow">or</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;sstFlagPrimary&quot;</span>
        <span class="ow">or</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;acmFlagPrimary&quot;</span>
        <span class="ow">or</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;cat4FlagPrimary&quot;</span>
    <span class="p">):</span>
        <span class="n">public_mask</span> <span class="o">=</span> <span class="n">primary_flag_values</span> <span class="o">!=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">anc_name</span> <span class="o">==</span> <span class="s2">&quot;xyzFlagPrimary&quot;</span><span class="p">:</span>
        <span class="n">public_mask</span> <span class="o">=</span> <span class="n">primary_flag_values</span> <span class="o">!=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;public&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">public_mask</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;nonpub&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="o">~</span><span class="n">public_mask</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">primary_flag_values</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.metaStationName" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaStationName</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns the metaStationName.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaStationName</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the metaStationName.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaStationName&quot;</span><span class="p">][:])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.set_dataset_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Sets self.stn, org, filename, url and loads self.nc. The key to understanding all of
this is that we are ultimately setting <em>url</em>, which can be an actual path to the
nc file or a url to THREDDS DoDS service.</p>
<h6 id="cdippy.cdipnc.CDIPnc.set_dataset_info--parameters">PARAMETERS</h6>
<p>stn : str
   Can be in 3char (e.g. 028) or 5char (e.g. 028p2) format for org=cdip
org: str
    (Organization) Values are: cdip|ww3|external
dataset_name : str
    Values: realtime|historic|archive|realtimexy|archivexy|
            predeploy|moored|offsite|recovered
deployment : int [optional]
    Supply this to access specific station deployment data.
    Must be &gt;= 1.</p>


<details class="paths-are" open>
  <summary>Paths are</summary>
  <p><top_dir>/EXTERNAL/WW3/<filename>  [filename=<stn><em><org_dir></em><dataset_name>.nc][CDIP stn like 192w3]
<top_dir>/REALTIME/<filename> [filename=<stn><p1><em>rt.nc]
<top_dir>/REALTIME/<filename> [filename=<stn><p1>_xy.nc]
<top_dir>/ARCHIVE/<stn>/<filename> [filename=<stn3><p1></em><deployment>.nc]
<top_dir>/PREDEPLOY/<stn>/<filename> [filename=<stn3><pX>_<deployment>_rt.nc]<strong>
<top_dir>/PREDEPLOY/<stn>/<filename> [filename=<stn3><pX>_<deployment>_xy.nc]</strong></p>
<p>**Active deployment directories are PREDEPLOY (p0), MOORED (p1), OFFSITE (p2)  and RECOVERED (p3)
  pX = p0|p1|p2|p3; deployment = dXX e.g. d01</p>
</details>

<details class="urls-are" open>
  <summary>Urls are</summary>
  <p>http://thredds.cdip.ucsd/thredds/dodsC/<org1>/<org_dir>/<filename>
   [org1=external|cdip,org_dir=WW3|OWI etc]
http://thredds.cdip.ucsd/thredds/dodsC/<org1>/<dataset_name>/<filename></p>
<p>Note:
   Since adding dataset_name, we no longer need the 5char stn id
   for org=cdip datasets. The p_val will be 'p1' for every dataset except
   active datasets in buoy states predeploy (p0), offsite (p2) and recovered (p3).</p>
</details>

            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_dataset_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deployment</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets self.stn, org, filename, url and loads self.nc. The key to understanding all of</span>
<span class="sd">    this is that we are ultimately setting _url_, which can be an actual path to the</span>
<span class="sd">    nc file or a url to THREDDS DoDS service.</span>

<span class="sd">    PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    stn : str</span>
<span class="sd">       Can be in 3char (e.g. 028) or 5char (e.g. 028p2) format for org=cdip</span>
<span class="sd">    org: str</span>
<span class="sd">        (Organization) Values are: cdip|ww3|external</span>
<span class="sd">    dataset_name : str</span>
<span class="sd">        Values: realtime|historic|archive|realtimexy|archivexy|</span>
<span class="sd">                predeploy|moored|offsite|recovered</span>
<span class="sd">    deployment : int [optional]</span>
<span class="sd">        Supply this to access specific station deployment data.</span>
<span class="sd">        Must be &gt;= 1.</span>

<span class="sd">    Paths are:</span>
<span class="sd">        &lt;top_dir&gt;/EXTERNAL/WW3/&lt;filename&gt;  [filename=&lt;stn&gt;_&lt;org_dir&gt;_&lt;dataset_name&gt;.nc][CDIP stn like 192w3]</span>
<span class="sd">        &lt;top_dir&gt;/REALTIME/&lt;filename&gt; [filename=&lt;stn&gt;&lt;p1&gt;_rt.nc]</span>
<span class="sd">        &lt;top_dir&gt;/REALTIME/&lt;filename&gt; [filename=&lt;stn&gt;&lt;p1&gt;_xy.nc]</span>
<span class="sd">        &lt;top_dir&gt;/ARCHIVE/&lt;stn&gt;/&lt;filename&gt; [filename=&lt;stn3&gt;&lt;p1&gt;_&lt;deployment&gt;.nc]</span>
<span class="sd">        &lt;top_dir&gt;/PREDEPLOY/&lt;stn&gt;/&lt;filename&gt; [filename=&lt;stn3&gt;&lt;pX&gt;_&lt;deployment&gt;_rt.nc]**</span>
<span class="sd">        &lt;top_dir&gt;/PREDEPLOY/&lt;stn&gt;/&lt;filename&gt; [filename=&lt;stn3&gt;&lt;pX&gt;_&lt;deployment&gt;_xy.nc]**</span>

<span class="sd">        **Active deployment directories are PREDEPLOY (p0), MOORED (p1), OFFSITE (p2)  and RECOVERED (p3)</span>
<span class="sd">          pX = p0|p1|p2|p3; deployment = dXX e.g. d01</span>

<span class="sd">    Urls are:</span>
<span class="sd">        http://thredds.cdip.ucsd/thredds/dodsC/&lt;org1&gt;/&lt;org_dir&gt;/&lt;filename&gt;</span>
<span class="sd">           [org1=external|cdip,org_dir=WW3|OWI etc]</span>
<span class="sd">        http://thredds.cdip.ucsd/thredds/dodsC/&lt;org1&gt;/&lt;dataset_name&gt;/&lt;filename&gt;</span>

<span class="sd">        Note:</span>
<span class="sd">           Since adding dataset_name, we no longer need the 5char stn id</span>
<span class="sd">           for org=cdip datasets. The p_val will be &#39;p1&#39; for every dataset except</span>
<span class="sd">           active datasets in buoy states predeploy (p0), offsite (p2) and recovered (p3).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="s2">&quot;.nc&quot;</span>

    <span class="c1"># Allowing data_dir to be either url or path</span>
    <span class="n">__using_path</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;http&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">__using_path</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">org</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">org</span> <span class="o">=</span> <span class="s2">&quot;cdip&quot;</span>
    <span class="k">if</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;cdip&quot;</span><span class="p">:</span>
        <span class="n">org1</span> <span class="o">=</span> <span class="s2">&quot;cdip&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">org1</span> <span class="o">=</span> <span class="s2">&quot;external&quot;</span>
    <span class="c1"># Org_dir follows &#39;external&#39; and always uppercase (isn&#39;t used when org is cdip)</span>
    <span class="n">org_dir</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="c1"># Handle the xy datasets</span>
    <span class="k">if</span> <span class="s2">&quot;xy&quot;</span> <span class="ow">in</span> <span class="n">dataset_name</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;xy&quot;</span>
        <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ftype</span> <span class="o">=</span> <span class="s2">&quot;rt&quot;</span>

    <span class="c1"># Historic and archive both use archive as a dataset_dir</span>
    <span class="c1"># Lowercase for url, uppercase for url</span>
    <span class="k">if</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;historic&quot;</span><span class="p">:</span>
        <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;archive&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">dataset_name</span>

    <span class="c1"># Local paths use uppercase</span>
    <span class="k">if</span> <span class="n">__using_path</span><span class="p">:</span>
        <span class="n">org1</span> <span class="o">=</span> <span class="n">org1</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">dataset_dir</span> <span class="o">=</span> <span class="n">dataset_dir</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;cdip&quot;</span><span class="p">:</span>
            <span class="n">url_pre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">url_pre</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">org1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">url_pre</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="n">org1</span><span class="p">])</span>

    <span class="c1"># Set p_val to &#39;p1&#39; - it will get changed appropriately below</span>
    <span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;p1&quot;</span>

    <span class="c1"># Make filename and url</span>
    <span class="k">if</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;cdip&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">deployment</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">deployment</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dataset_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_datasets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_datasets</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
            <span class="n">dataset_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">deployment</span><span class="p">,</span> <span class="n">ftype</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;realtime&quot;</span><span class="p">:</span>
            <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="k">elif</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;historic&quot;</span><span class="p">:</span>
            <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">stn</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s2">&quot;archive&quot;</span> <span class="ow">and</span> <span class="n">deployment</span><span class="p">:</span>
            <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">deployment</span>
            <span class="n">dataset_dir</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">dataset_dir</span><span class="p">,</span> <span class="n">stn</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">stn</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">url_pre</span><span class="p">,</span> <span class="n">dataset_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;p&quot;</span> <span class="ow">and</span> <span class="n">org</span> <span class="o">==</span> <span class="s2">&quot;ww3&quot;</span><span class="p">:</span>  <span class="c1"># Cdip stn id</span>
            <span class="n">stn_tmp</span> <span class="o">=</span> <span class="n">ndbc</span><span class="o">.</span><span class="n">get_wmo_id</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stn_tmp</span> <span class="o">=</span> <span class="n">stn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">stn_tmp</span><span class="p">,</span> <span class="n">org_dir</span><span class="p">,</span> <span class="n">dataset_name</span> <span class="o">+</span> <span class="n">ext</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">url_pre</span><span class="p">,</span> <span class="n">org_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">])</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">org</span> <span class="o">=</span> <span class="n">org</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.set_request_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_request_info</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vrs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;waveHs&#39;</span><span class="p">],</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initializes data request information for get_request.</p>
<h6 id="cdippy.cdipnc.CDIPnc.set_request_info--parameters">PARAMETERS</h6>
<p>start : str or datetime [optional] : default Jan 1, 1975
    Start time of data request (UTC). If provided as a string must
    be in the format Y-m-d H:M:S where Y is 4 chars and all others
    are 2 chars. Ex. '2020-03-30 19:32:56'.
end : str or datetime [optional] : default now
    End time of data request (UTC). If not supplied defaults to now.
vrs : list [optional] : default ['waveHs']
    A list of the names of variables to retrieve. They all must start
    with the same prefix, e.g. ['waveHs', 'waveTp', 'waveDp']
pub_set: str [optional] values = public|nonpub|all
    Filters data based on data quality flags.
apply_mask: bool [optional] default True
    Removes values from the masked array that have a mask value of True.
    Ex. If nonpub data is requested and apply_mask is False, the returned
    array will contain both public and nonpublic data (although public
    data records will have the mask value set to True). If apply_mask
    is set to True, only nonpub records will be returned.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_request_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vrs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveHs&quot;</span><span class="p">],</span>
    <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
    <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes data request information for get_request.</span>

<span class="sd">    PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    start : str or datetime [optional] : default Jan 1, 1975</span>
<span class="sd">        Start time of data request (UTC). If provided as a string must</span>
<span class="sd">        be in the format Y-m-d H:M:S where Y is 4 chars and all others</span>
<span class="sd">        are 2 chars. Ex. &#39;2020-03-30 19:32:56&#39;.</span>
<span class="sd">    end : str or datetime [optional] : default now</span>
<span class="sd">        End time of data request (UTC). If not supplied defaults to now.</span>
<span class="sd">    vrs : list [optional] : default [&#39;waveHs&#39;]</span>
<span class="sd">        A list of the names of variables to retrieve. They all must start</span>
<span class="sd">        with the same prefix, e.g. [&#39;waveHs&#39;, &#39;waveTp&#39;, &#39;waveDp&#39;]</span>
<span class="sd">    pub_set: str [optional] values = public|nonpub|all</span>
<span class="sd">        Filters data based on data quality flags.</span>
<span class="sd">    apply_mask: bool [optional] default True</span>
<span class="sd">        Removes values from the masked array that have a mask value of True.</span>
<span class="sd">        Ex. If nonpub data is requested and apply_mask is False, the returned</span>
<span class="sd">        array will contain both public and nonpublic data (although public</span>
<span class="sd">        data records will have the mask value set to True). If apply_mask</span>
<span class="sd">        is set to True, only nonpub records will be returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_timespan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pub_set</span><span class="p">(</span><span class="n">pub_set</span><span class="p">)</span>  <span class="c1"># Standardize the set name</span>
    <span class="k">if</span> <span class="n">apply_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="n">apply_mask</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="n">vrs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.CDIPnc.set_timespan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_timespan</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Sets request timespan</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_timespan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets request timespan&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_dt</span> <span class="o">=</span> <span class="n">start</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">tzinfo</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_dt</span> <span class="o">=</span> <span class="n">end</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_dt</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_dt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.Historic" class="doc doc-heading">
            <code>Historic</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CDIPnc (cdippy.cdipnc.CDIPnc)" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a></code></p>


        <p>Loads the historic nc file for a given station.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Historic</span><span class="p">(</span><span class="n">CDIPnc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads the historic nc file for a given station.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For parameters see CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>

        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;historic&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Historic.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>For parameters see CDIPnc.set_dataset_info.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For parameters see CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>

    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;historic&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.Latest" class="doc doc-heading">
            <code>Latest</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CDIPnc (cdippy.cdipnc.CDIPnc)" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a></code></p>


        <p>Loads the latest_3day.nc and has methods for retrieving the data.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Latest</span><span class="p">(</span><span class="n">CDIPnc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads the latest_3day.nc and has methods for retrieving the data.&quot;&quot;&quot;</span>

    <span class="c1"># Do not apply the mask to get_request calls.</span>
    <span class="n">apply_mask</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        data_dir : str [optional]</span>
<span class="sd">            Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">            of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># - Holds stn labels, e.g. &#39;100p1&#39; for this instance</span>
        <span class="c1"># Set latest timespan (Latest_3day goes up to 30 minutes beyond now)</span>
        <span class="n">now_plus_30min</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="c1"># Using the unix epoch to catch all data in latest_3day in case the file is very old</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_timespan</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">now_plus_30min</span><span class="p">)</span>

        <span class="c1"># Set basic information and init self.nc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;latest_3day.nc&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;REALTIME&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span><span class="n">CDIPnc</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="n">CDIPnc</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="s2">&quot;cdip/realtime/latest_3day.nc&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaStationNames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get list of latest station names.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaStationName&quot;</span><span class="p">]:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">name_arr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">names</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaSiteLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets and returns self.labels, a list of station labels, e.g. [&#39;100p1&#39;,...].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">label_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaSiteLabel&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">label_arr</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaDeployLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of metaDeployLabels.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaDeployLabel&quot;</span><span class="p">]:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">label_arr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaDeployNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of metaDeployNumbers.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaDeployNumber&quot;</span><span class="p">]:</span>
            <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numbers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaWMOids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of WMO ids, e.g. [&#39;46225&#39;,...].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">label_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaWMOid&quot;</span><span class="p">]:</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">label_arr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaLatitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of station latitudes, e.g. [23.4,...].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaLatitude&quot;</span><span class="p">][:]:</span>
            <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaLongitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of station longitudes, e.g. [23.4,...].&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaLongitude&quot;</span><span class="p">][:]:</span>
            <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lons</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">metaWaterDepths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a list of station water depths.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">depths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaWaterDepth&quot;</span><span class="p">][:]:</span>
            <span class="n">depths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depths</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_latest</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
        <span class="n">meta_vars</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">array_format</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        By default, array_format = True, it will return a dictionary of numpy masked</span>
<span class="sd">        arrays of the latest requested parameters as well as metadata information.</span>

<span class="sd">        If array_format = False, it returns a list of dicts. Each dict will contain</span>
<span class="sd">        latest station data and metadata.</span>

<span class="sd">        Parameter data values that are masked or non-existant are set to np.nan.</span>
<span class="sd">        Time values (e.g. &#39;waveTime&#39;) for the wave data if masked or non-existant</span>
<span class="sd">        are set to None.</span>

<span class="sd">        Both meta_vars and params if None (or not included in the argument list) will</span>
<span class="sd">        return default sets of meta_vars and parameters. If meta_vars and params are set</span>
<span class="sd">        just those will be returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Use these if params (or meta_vars) is None</span>

        <span class="n">default_params_by_type</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;wave&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;waveHs&quot;</span><span class="p">,</span> <span class="s2">&quot;waveTp&quot;</span><span class="p">,</span> <span class="s2">&quot;waveDp&quot;</span><span class="p">,</span> <span class="s2">&quot;waveTa&quot;</span><span class="p">],</span>
            <span class="s2">&quot;sst&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sstSeaSurfaceTemperature&quot;</span><span class="p">],</span>
            <span class="s2">&quot;acm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;acmSpeed&quot;</span><span class="p">,</span> <span class="s2">&quot;acmDirection&quot;</span><span class="p">],</span>
            <span class="s2">&quot;cat4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cat4AirTemperature&quot;</span><span class="p">],</span>
            <span class="s2">&quot;gps&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gpsLongitude&quot;</span><span class="p">,</span> <span class="s2">&quot;gpsLatitude&quot;</span><span class="p">],</span>
            <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;metaLongitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metaLatitude&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metaWaterDepth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metaStationName&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metaSiteLabel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metaDeployLabel&quot;</span><span class="p">,</span>
                <span class="s2">&quot;metaWMOid&quot;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">default_params_by_type</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;meta&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                    <span class="n">params</span> <span class="o">+=</span> <span class="n">default_params_by_type</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

        <span class="c1"># Initialize requested parameters by type</span>

        <span class="n">requested_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">default_params_by_type</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">requested_params</span><span class="p">:</span>
                        <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">requested_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">requested_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pub_set</span><span class="p">(</span><span class="n">pub_set</span><span class="p">)</span>

        <span class="c1"># Load meta variables</span>

        <span class="k">if</span> <span class="n">meta_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">meta_vars</span> <span class="o">=</span> <span class="n">default_params_by_type</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span>

        <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">meta_vars</span><span class="p">:</span>
            <span class="n">meta</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)()</span>

        <span class="c1"># We always need these to remove duplicates</span>

        <span class="n">site_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaSiteLabels</span><span class="p">()</span>
        <span class="n">deploy_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaDeployLabels</span><span class="p">()</span>

        <span class="c1"># Loop through the data types (e.g. &#39;wave&#39;, &#39;sst&#39;, &#39;acm&#39; ...)</span>
        <span class="c1"># and grab data for the parameters requested.</span>

        <span class="n">req</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">requested_types</span><span class="p">:</span>

            <span class="c1"># Add the parameters requested into the request list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Add the necessary time variables into the request list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">,</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeBounds&quot;</span><span class="p">]</span>

            <span class="c1"># Make the data request for the included parameters and time variables.</span>
            <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

            <span class="c1"># We don&#39;t quality check the GPS</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
                <span class="n">pub_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pub_mask</span><span class="p">(</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;FlagPrimary&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">pub_mask</span><span class="p">)</span>
                <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

        <span class="n">num_stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;waveTimeOffset&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store station dictionaries</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_stations</span><span class="p">):</span>
            <span class="n">stn</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># To remove duplicates (p1 usually) use the site label as a key, e.g. 162p1</span>
            <span class="c1"># We will be keeping the pX with the greatest deploy label.</span>

            <span class="n">site_label</span> <span class="o">=</span> <span class="n">site_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">site_label</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">deploy_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">[</span><span class="n">site_label</span><span class="p">][</span><span class="s2">&quot;deploy_label&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

            <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;deploy_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deploy_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

            <span class="n">latest_timestamp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># To help find a time</span>
            <span class="n">latest_type</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># for the group of</span>
            <span class="n">waves_included</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># parameters.</span>
            <span class="n">has_data</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">requested_types</span><span class="p">:</span>
                <span class="n">offsets</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">][:,</span> <span class="n">s</span><span class="p">]</span>
                <span class="n">t_n</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
                <span class="n">tb_n</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeBounds&quot;</span>
                <span class="c1"># Find the highest data index (latest data) for the type</span>
                <span class="c1"># using the TimeOffset.</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__has_a_number</span><span class="p">(</span><span class="n">offsets</span><span class="p">):</span>
                    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">flatnotmasked_edges</span><span class="p">(</span><span class="n">offsets</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">t_n</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">tb_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                        <span class="n">stn</span><span class="p">[</span><span class="n">tb_n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">tb_n</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">pm</span> <span class="ow">in</span> <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]:</span>
                        <span class="n">stn</span><span class="p">[</span><span class="n">pm</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">pm</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
                        <span class="n">has_data</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">tb_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="k">for</span> <span class="n">pm</span> <span class="ow">in</span> <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]:</span>
                        <span class="n">stn</span><span class="p">[</span><span class="n">pm</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">and</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;wave&quot;</span><span class="p">:</span>
                        <span class="n">waves_included</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">latest_timestamp</span><span class="p">:</span>
                        <span class="n">latest_timestamp</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span>
                        <span class="n">latest_type</span> <span class="o">=</span> <span class="n">typ</span>
            <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;hasParameterData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_data</span>
            <span class="k">if</span> <span class="n">latest_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">group_type</span> <span class="o">=</span> <span class="s2">&quot;wave&quot;</span> <span class="k">if</span> <span class="n">waves_included</span> <span class="k">else</span> <span class="n">latest_type</span>
                <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="n">group_type</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span><span class="p">]</span>
                <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTimeBounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="n">group_type</span> <span class="o">+</span> <span class="s2">&quot;TimeBounds&quot;</span><span class="p">]</span>
                <span class="n">least_timestamp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTime&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">requested_types</span><span class="p">:</span>
                    <span class="n">t_n</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
                    <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">and</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">least_timestamp</span><span class="p">:</span>
                        <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTimeBounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meta_vars</span><span class="p">:</span>
                <span class="n">stn</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;hasParameterData&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_vars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">site_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">stn</span>

        <span class="c1"># To satisfy the original array_format = False, remove the site Labels</span>

        <span class="n">new_result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">site_label</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">new_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">site_label</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">new_result</span>

        <span class="c1"># Return parameters as lists in a single dict rather than a list of dicts.</span>

        <span class="n">array_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">array_format</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">array_result</span><span class="p">:</span>
                        <span class="n">array_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">array_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">array_result</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__has_a_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test if there is at least one number in the array&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.__has_a_number" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__has_a_number</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Test if there is at least one number in the array</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__has_a_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test if there is at least one number in the array&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <h6 id="cdippy.cdipnc.Latest.__init__--parameters">PARAMETERS</h6>
<p>data_dir : str [optional]
    Either a full path to a directory containing a local directory hierarchy
    of nc files. E.g. '/project/WNC' or a url to a THREDDS server.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    data_dir : str [optional]</span>
<span class="sd">        Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">        of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># - Holds stn labels, e.g. &#39;100p1&#39; for this instance</span>
    <span class="c1"># Set latest timespan (Latest_3day goes up to 30 minutes beyond now)</span>
    <span class="n">now_plus_30min</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="c1"># Using the unix epoch to catch all data in latest_3day in case the file is very old</span>
    <span class="n">epoch</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_timespan</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">now_plus_30min</span><span class="p">)</span>

    <span class="c1"># Set basic information and init self.nc</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;latest_3day.nc&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;REALTIME&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="n">CDIPnc</span><span class="o">.</span><span class="n">THREDDS_url</span><span class="p">,</span> <span class="n">CDIPnc</span><span class="o">.</span><span class="n">dods</span><span class="p">,</span> <span class="s2">&quot;cdip/realtime/latest_3day.nc&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.get_latest" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_latest</span><span class="p">(</span><span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="n">meta_vars</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">array_format</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>By default, array_format = True, it will return a dictionary of numpy masked
arrays of the latest requested parameters as well as metadata information.</p>
<p>If array_format = False, it returns a list of dicts. Each dict will contain
latest station data and metadata.</p>
<p>Parameter data values that are masked or non-existant are set to np.nan.
Time values (e.g. 'waveTime') for the wave data if masked or non-existant
are set to None.</p>
<p>Both meta_vars and params if None (or not included in the argument list) will
return default sets of meta_vars and parameters. If meta_vars and params are set
just those will be returned.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_latest</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
    <span class="n">meta_vars</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">array_format</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    By default, array_format = True, it will return a dictionary of numpy masked</span>
<span class="sd">    arrays of the latest requested parameters as well as metadata information.</span>

<span class="sd">    If array_format = False, it returns a list of dicts. Each dict will contain</span>
<span class="sd">    latest station data and metadata.</span>

<span class="sd">    Parameter data values that are masked or non-existant are set to np.nan.</span>
<span class="sd">    Time values (e.g. &#39;waveTime&#39;) for the wave data if masked or non-existant</span>
<span class="sd">    are set to None.</span>

<span class="sd">    Both meta_vars and params if None (or not included in the argument list) will</span>
<span class="sd">    return default sets of meta_vars and parameters. If meta_vars and params are set</span>
<span class="sd">    just those will be returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Use these if params (or meta_vars) is None</span>

    <span class="n">default_params_by_type</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;wave&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;waveHs&quot;</span><span class="p">,</span> <span class="s2">&quot;waveTp&quot;</span><span class="p">,</span> <span class="s2">&quot;waveDp&quot;</span><span class="p">,</span> <span class="s2">&quot;waveTa&quot;</span><span class="p">],</span>
        <span class="s2">&quot;sst&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sstSeaSurfaceTemperature&quot;</span><span class="p">],</span>
        <span class="s2">&quot;acm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;acmSpeed&quot;</span><span class="p">,</span> <span class="s2">&quot;acmDirection&quot;</span><span class="p">],</span>
        <span class="s2">&quot;cat4&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cat4AirTemperature&quot;</span><span class="p">],</span>
        <span class="s2">&quot;gps&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;gpsLongitude&quot;</span><span class="p">,</span> <span class="s2">&quot;gpsLatitude&quot;</span><span class="p">],</span>
        <span class="s2">&quot;meta&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;metaLongitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metaLatitude&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metaWaterDepth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metaStationName&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metaSiteLabel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metaDeployLabel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;metaWMOid&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">default_params_by_type</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;meta&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">+=</span> <span class="n">default_params_by_type</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

    <span class="c1"># Initialize requested parameters by type</span>

    <span class="n">requested_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">default_params_by_type</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">requested_params</span><span class="p">:</span>
                    <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">requested_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">requested_params</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pub_set</span><span class="p">(</span><span class="n">pub_set</span><span class="p">)</span>

    <span class="c1"># Load meta variables</span>

    <span class="k">if</span> <span class="n">meta_vars</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">meta_vars</span> <span class="o">=</span> <span class="n">default_params_by_type</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">meta_vars</span><span class="p">:</span>
        <span class="n">meta</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span><span class="p">)()</span>

    <span class="c1"># We always need these to remove duplicates</span>

    <span class="n">site_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaSiteLabels</span><span class="p">()</span>
    <span class="n">deploy_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaDeployLabels</span><span class="p">()</span>

    <span class="c1"># Loop through the data types (e.g. &#39;wave&#39;, &#39;sst&#39;, &#39;acm&#39; ...)</span>
    <span class="c1"># and grab data for the parameters requested.</span>

    <span class="n">req</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">requested_types</span><span class="p">:</span>

        <span class="c1"># Add the parameters requested into the request list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Add the necessary time variables into the request list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">,</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeBounds&quot;</span><span class="p">]</span>

        <span class="c1"># Make the data request for the included parameters and time variables.</span>
        <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

        <span class="c1"># We don&#39;t quality check the GPS</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
            <span class="n">pub_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pub_mask</span><span class="p">(</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;FlagPrimary&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">mask_or</span><span class="p">(</span><span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">pub_mask</span><span class="p">)</span>
            <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>

    <span class="n">num_stations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;waveTimeOffset&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Store station dictionaries</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_stations</span><span class="p">):</span>
        <span class="n">stn</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># To remove duplicates (p1 usually) use the site label as a key, e.g. 162p1</span>
        <span class="c1"># We will be keeping the pX with the greatest deploy label.</span>

        <span class="n">site_label</span> <span class="o">=</span> <span class="n">site_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">site_label</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deploy_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">[</span><span class="n">site_label</span><span class="p">][</span><span class="s2">&quot;deploy_label&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>

        <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;deploy_label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">deploy_labels</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

        <span class="n">latest_timestamp</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># To help find a time</span>
        <span class="n">latest_type</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># for the group of</span>
        <span class="n">waves_included</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># parameters.</span>
        <span class="n">has_data</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">requested_types</span><span class="p">:</span>
            <span class="n">offsets</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeOffset&quot;</span><span class="p">][:,</span> <span class="n">s</span><span class="p">]</span>
            <span class="n">t_n</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
            <span class="n">tb_n</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;TimeBounds&quot;</span>
            <span class="c1"># Find the highest data index (latest data) for the type</span>
            <span class="c1"># using the TimeOffset.</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__has_a_number</span><span class="p">(</span><span class="n">offsets</span><span class="p">):</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">flatnotmasked_edges</span><span class="p">(</span><span class="n">offsets</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">t_n</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="n">stn</span><span class="p">[</span><span class="n">tb_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">tb_n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">tb_n</span><span class="p">][</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">offsets</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">pm</span> <span class="ow">in</span> <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]:</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">pm</span><span class="p">]</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="n">typ</span><span class="p">][</span><span class="n">pm</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
                    <span class="n">has_data</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">stn</span><span class="p">[</span><span class="n">tb_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="k">for</span> <span class="n">pm</span> <span class="ow">in</span> <span class="n">requested_params</span><span class="p">[</span><span class="n">typ</span><span class="p">]:</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">pm</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">and</span> <span class="n">typ</span> <span class="o">!=</span> <span class="s2">&quot;gps&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s2">&quot;wave&quot;</span><span class="p">:</span>
                    <span class="n">waves_included</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">latest_timestamp</span><span class="p">:</span>
                    <span class="n">latest_timestamp</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span>
                    <span class="n">latest_type</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;hasParameterData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_data</span>
        <span class="k">if</span> <span class="n">latest_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">group_type</span> <span class="o">=</span> <span class="s2">&quot;wave&quot;</span> <span class="k">if</span> <span class="n">waves_included</span> <span class="k">else</span> <span class="n">latest_type</span>
            <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="n">group_type</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span><span class="p">]</span>
            <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTimeBounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stn</span><span class="p">[</span><span class="n">group_type</span> <span class="o">+</span> <span class="s2">&quot;TimeBounds&quot;</span><span class="p">]</span>
            <span class="n">least_timestamp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTime&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">requested_types</span><span class="p">:</span>
                <span class="n">t_n</span> <span class="o">=</span> <span class="n">typ</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
                <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="ow">and</span> <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">least_timestamp</span><span class="p">:</span>
                    <span class="n">stn</span><span class="p">[</span><span class="n">t_n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;groupTimeBounds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">meta_vars</span><span class="p">:</span>
            <span class="n">stn</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">stn</span><span class="p">[</span><span class="s2">&quot;hasParameterData&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">meta_vars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">site_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">stn</span>

    <span class="c1"># To satisfy the original array_format = False, remove the site Labels</span>

    <span class="n">new_result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">site_label</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">new_result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">site_label</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">new_result</span>

    <span class="c1"># Return parameters as lists in a single dict rather than a list of dicts.</span>

    <span class="n">array_result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">array_format</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">array_result</span><span class="p">:</span>
                    <span class="n">array_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">array_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">array_result</span>

    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaDeployLabels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaDeployLabels</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a list of metaDeployLabels.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaDeployLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of metaDeployLabels.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">label_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaDeployLabel&quot;</span><span class="p">]:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">label_arr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaDeployNumbers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaDeployNumbers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a list of metaDeployNumbers.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaDeployNumbers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of metaDeployNumbers.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">numbers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaDeployNumber&quot;</span><span class="p">]:</span>
        <span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numbers</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaLatitudes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaLatitudes</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a list of station latitudes, e.g. [23.4,...].</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaLatitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of station latitudes, e.g. [23.4,...].&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaLatitude&quot;</span><span class="p">][:]:</span>
        <span class="n">lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaLongitudes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaLongitudes</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a list of station longitudes, e.g. [23.4,...].</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaLongitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of station longitudes, e.g. [23.4,...].&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaLongitude&quot;</span><span class="p">][:]:</span>
        <span class="n">lons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lons</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaSiteLabels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaSiteLabels</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Sets and returns self.labels, a list of station labels, e.g. ['100p1',...].</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaSiteLabels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets and returns self.labels, a list of station labels, e.g. [&#39;100p1&#39;,...].&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">label_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaSiteLabel&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">label_arr</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaStationNames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaStationNames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Get list of latest station names.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaStationNames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get list of latest station names.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaStationName&quot;</span><span class="p">]:</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">name_arr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaWMOids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaWMOids</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a list of WMO ids, e.g. ['46225',...].</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaWMOids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of WMO ids, e.g. [&#39;46225&#39;,...].&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">label_arr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaWMOid&quot;</span><span class="p">]:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">byte_arr_to_string</span><span class="p">(</span><span class="n">label_arr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">labels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Latest.metaWaterDepths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">metaWaterDepths</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a list of station water depths.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">metaWaterDepths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a list of station water depths.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">depths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;metaWaterDepth&quot;</span><span class="p">][:]:</span>
        <span class="n">depths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">depths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.Realtime" class="doc doc-heading">
            <code>Realtime</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CDIPnc (cdippy.cdipnc.CDIPnc)" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a></code></p>


        <p>Loads the realtime nc file for the given station.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Realtime</span><span class="p">(</span><span class="n">CDIPnc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads the realtime nc file for the given station.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For parameters: See CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>
        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;realtime&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.Realtime.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>For parameters: See CDIPnc.set_dataset_info.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For parameters: See CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>
    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;realtime&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.cdipnc.RealtimeXY" class="doc doc-heading">
            <code>RealtimeXY</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Archive (cdippy.cdipnc.Archive)" href="#cdippy.cdipnc.Archive">Archive</a></code></p>


        <p>Loads the realtime xy nc file for the given station.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RealtimeXY</span><span class="p">(</span><span class="n">Archive</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads the realtime xy nc file for the given station.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;For parameters see CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>
        <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;realtimexy&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.cdipnc.RealtimeXY.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>For parameters see CDIPnc.set_dataset_info.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/cdipnc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For parameters see CDIPnc.set_dataset_info.&quot;&quot;&quot;</span>
    <span class="n">CDIPnc</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dataset_info</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">org</span><span class="p">,</span> <span class="s2">&quot;realtimexy&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="cdippy.nchashes" class="doc doc-heading">
            <code>cdippy.nchashes</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="cdippy.nchashes.NcHashes" class="doc doc-heading">
            <code>NcHashes</code>


</h3>


    <div class="doc doc-contents ">


        <p>A class that checks for changes to datasets since by reading the online list of historic netCDF file hashes.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/nchashes.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NcHashes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that checks for changes to datasets since by reading the online list of historic netCDF file hashes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hashes_url</span> <span class="o">=</span> <span class="s2">&quot;http://cdip.ucsd.edu/data_access/metadata/wavecdf_by_datemod.txt&quot;</span>
    <span class="n">new_hashes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hash_file_location</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hash_pkl</span> <span class="o">=</span> <span class="n">hash_file_location</span> <span class="o">+</span> <span class="s2">&quot;/HASH.pkl&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_hash_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">read_url</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hashes_url</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;filename&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">[</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compare_hash_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compare the current in-memory list of files, loaded by `load_hash_table` to the list saved in HASH.pkl and return a list of stations that are new or have changed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            changed ([str]): A list of nc files that have changed or are since HASH.pkl was last saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">old_hashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_old_hashes</span><span class="p">()</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">old_hashes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">key</span> <span class="ow">in</span> <span class="n">old_hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">old_hashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="p">):</span>
                    <span class="n">changed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">changed</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_new_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cdip_utils</span><span class="o">.</span><span class="n">pkl_dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_pkl</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_old_hashes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">pkl_load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hash_pkl</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.nchashes.NcHashes.compare_hash_tables" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compare_hash_tables</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Compare the current in-memory list of files, loaded by <code>load_hash_table</code> to the list saved in HASH.pkl and return a list of stations that are new or have changed.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>changed</code></b>(                  <code>[<span title="str">str</span>]</code>
)              –
              <div class="doc-md-description">
                <p>A list of nc files that have changed or are since HASH.pkl was last saved.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/nchashes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compare_hash_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare the current in-memory list of files, loaded by `load_hash_table` to the list saved in HASH.pkl and return a list of stations that are new or have changed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        changed ([str]): A list of nc files that have changed or are since HASH.pkl was last saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">old_hashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_old_hashes</span><span class="p">()</span>
    <span class="n">changed</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">old_hashes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">key</span> <span class="ow">in</span> <span class="n">old_hashes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">old_hashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_hashes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">changed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">changed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="cdippy.ncstats" class="doc doc-heading">
            <code>cdippy.ncstats</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="cdippy.ncstats.NcStats" class="doc doc-heading">
            <code>NcStats</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="StnData (cdippy.stndata.StnData)" href="#cdippy.stndata.StnData">StnData</a></code></p>


        <p>Produces data availability statistics for a given station.</p>


<details class="this-class-provides-methods-to" open>
  <summary>This class provides methods to</summary>
  <ul>
<li>Return counts for the entire station record, intended for use by web applications.</li>
<li>Save availability counts (e.g., xyz counts) for individual NetCDF files.
  Updates to totals are calculated by re-summarizing any files that have changed
  and aggregating all files to produce new totals.</li>
</ul>
</details>







              <details class="quote">
                <summary>Source code in <code>cdippy/ncstats.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NcStats</span><span class="p">(</span><span class="n">StnData</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produces data availability statistics for a given station.</span>

<span class="sd">    This class provides methods to:</span>
<span class="sd">        * Return counts for the entire station record, intended for use by web applications.</span>
<span class="sd">        * Save availability counts (e.g., xyz counts) for individual NetCDF files.</span>
<span class="sd">          Updates to totals are calculated by re-summarizing any files that have changed</span>
<span class="sd">          and aggregating all files to produce new totals.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">QC_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveFlagPrimary&quot;</span><span class="p">,</span> <span class="s2">&quot;sstFlagPrimary&quot;</span><span class="p">,</span> <span class="s2">&quot;gpsStatusFlags&quot;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes an NcStats instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            stn (str): Station identifier.</span>
<span class="sd">            data_dir (str, optional): Path to the data directory. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">StnData</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">date_modifieds</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1975-01-01 00:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes station-level statistics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing:</span>
<span class="sd">                - &quot;flag_counts&quot; (dict): Flag count summaries for the station.</span>
<span class="sd">                - &quot;deployments&quot; (dict): Deployment summary statistics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;flag_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_counts</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;deployments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment_summary</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deployment_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generates deployment summary statistics.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing:</span>
<span class="sd">                - Deployment IDs as keys, with values containing start and end coverage times.</span>
<span class="sd">                - &quot;number_of_deployments&quot; (int): The number of deployments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_nc_files</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dep_cnt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">nc_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">:</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="n">nc_name</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dep</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
                <span class="n">dep_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">result</span><span class="p">[</span><span class="n">dep</span><span class="p">][</span><span class="s2">&quot;time_coverage_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">[</span>
                    <span class="n">nc_name</span>
                <span class="p">]</span><span class="o">.</span><span class="n">get_coverage_start</span><span class="p">()</span>
                <span class="n">result</span><span class="p">[</span><span class="n">dep</span><span class="p">][</span><span class="s2">&quot;time_coverage_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">[</span>
                    <span class="n">nc_name</span>
                <span class="p">]</span><span class="o">.</span><span class="n">get_coverage_end</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;number_of_deployments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_cnt</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_nc_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;realtime&quot;</span><span class="p">,</span> <span class="s2">&quot;historic&quot;</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads NetCDF files for the station.</span>

<span class="sd">        Args:</span>
<span class="sd">            types (list, optional): List of file categories to load. Defaults to</span>
<span class="sd">                [&quot;realtime&quot;, &quot;historic&quot;, &quot;archive&quot;].</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary of NetCDF file objects keyed by filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc_files</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a specific NetCDF file into the instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            nc_filename (str): Filename of the NetCDF file.</span>

<span class="sd">        Sets:</span>
<span class="sd">            self.nc: Loaded NetCDF file object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nc_filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">[</span><span class="n">nc_filename</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_to_url</span><span class="p">(</span><span class="n">nc_filename</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_date_modifieds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">store_date_modified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nc_file_summaries</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_nc_files</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">nc_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">nc_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_file_summary</span><span class="p">(</span><span class="n">nc_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">nc_file_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes a summary for a given NetCDF file.</span>

<span class="sd">        Args:</span>
<span class="sd">            nc_filename (str): Name of the NetCDF file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Summary statistics for the file, including:</span>
<span class="sd">                - &quot;flag_counts&quot; (dict): Flag count statistics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">nc_filename</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># - Currently have just one summary</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;flag_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_counts</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">flag_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QC_flags</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Computes counts of flag variables for the entire station record.</span>

<span class="sd">        Args:</span>
<span class="sd">            QC_flags (list, optional): List of quality-control flag variable names.</span>
<span class="sd">                Defaults to `self.QC_flags`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: A dictionary containing:</span>
<span class="sd">                - &quot;totals&quot; (dict[str, pandas.DataFrame]): Total counts per flag.</span>
<span class="sd">                - &quot;by_month&quot; (dict[str, pandas.DataFrame]): Monthly counts per flag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;totals&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;by_month&quot;</span><span class="p">:</span> <span class="p">{}}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">QC_flags</span><span class="p">:</span>
            <span class="n">QC_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QC_flags</span>
        <span class="k">for</span> <span class="n">flag_name</span> <span class="ow">in</span> <span class="n">QC_flags</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="p">[</span><span class="n">flag_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span><span class="p">)</span>
            <span class="n">cat_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_categorical_flag_var</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;totals&quot;</span><span class="p">][</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_count</span><span class="p">(</span><span class="n">cat_var</span><span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="s2">&quot;by_month&quot;</span><span class="p">][</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_month_count</span><span class="p">(</span><span class="n">cat_var</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">total_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_var</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts totals for a given categorical flag variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            cat_var (pandas.Categorical): Categorical flag variable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: DataFrame with counts grouped by category.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;cnt&quot;</span><span class="p">:</span> <span class="n">cat_var</span><span class="p">})</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cat_var</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">by_month_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_var</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts observations by month for a given flag variable.</span>

<span class="sd">        Args:</span>
<span class="sd">            cat_var (pandas.Categorical): Categorical flag variable.</span>
<span class="sd">            dim (str): Dimension name prefix for the time variable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.DataFrame: DataFrame with counts grouped by month and flag value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;cnt&quot;</span><span class="p">:</span> <span class="n">cat_var</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dim</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">mon_map</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">mon_map</span><span class="p">,</span> <span class="n">cat_var</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_categorical_flag_var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">flag_name</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_flag_values</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">cat</span><span class="o">.</span><span class="n">rename_categories</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_flag_meanings</span><span class="p">(</span><span class="n">flag_name</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initializes an NcStats instance.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>stn</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Station identifier.</p>
              </div>
            </li>
            <li>
              <b><code>data_dir</code></b>
                  (<code><span title="str">str</span></code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Path to the data directory. Defaults to None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initializes an NcStats instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        stn (str): Station identifier.</span>
<span class="sd">        data_dir (str, optional): Path to the data directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">StnData</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">date_modifieds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;1975-01-01 00:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.by_month_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">by_month_count</span><span class="p">(</span><span class="n">cat_var</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Counts observations by month for a given flag variable.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>cat_var</code></b>
                  (<code><span title="pandas.Categorical">Categorical</span></code>)
              –
              <div class="doc-md-description">
                <p>Categorical flag variable.</p>
              </div>
            </li>
            <li>
              <b><code>dim</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Dimension name prefix for the time variable.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pandas.DataFrame: DataFrame with counts grouped by month and flag value.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">by_month_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_var</span><span class="p">,</span> <span class="n">dim</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Counts observations by month for a given flag variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        cat_var (pandas.Categorical): Categorical flag variable.</span>
<span class="sd">        dim (str): Dimension name prefix for the time variable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: DataFrame with counts grouped by month and flag value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;cnt&quot;</span><span class="p">:</span> <span class="n">cat_var</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dim</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">mon_map</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">mon_map</span><span class="p">,</span> <span class="n">cat_var</span><span class="p">])</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.deployment_summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">deployment_summary</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generates deployment summary statistics.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>A dictionary containing:
- Deployment IDs as keys, with values containing start and end coverage times.
- "number_of_deployments" (int): The number of deployments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">deployment_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates deployment summary statistics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing:</span>
<span class="sd">            - Deployment IDs as keys, with values containing start and end coverage times.</span>
<span class="sd">            - &quot;number_of_deployments&quot; (int): The number of deployments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_nc_files</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">dep_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">nc_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">:</span>
        <span class="n">dep</span> <span class="o">=</span> <span class="n">nc_name</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dep</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span>
            <span class="n">dep_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">result</span><span class="p">[</span><span class="n">dep</span><span class="p">][</span><span class="s2">&quot;time_coverage_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">[</span>
                <span class="n">nc_name</span>
            <span class="p">]</span><span class="o">.</span><span class="n">get_coverage_start</span><span class="p">()</span>
            <span class="n">result</span><span class="p">[</span><span class="n">dep</span><span class="p">][</span><span class="s2">&quot;time_coverage_end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">[</span>
                <span class="n">nc_name</span>
            <span class="p">]</span><span class="o">.</span><span class="n">get_coverage_end</span><span class="p">()</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;number_of_deployments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dep_cnt</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.flag_counts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flag_counts</span><span class="p">(</span><span class="n">QC_flags</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Computes counts of flag variables for the entire station record.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>QC_flags</code></b>
                  (<code><span title="list">list</span></code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>List of quality-control flag variable names.
Defaults to <code>self.QC_flags</code>.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>A dictionary containing:
- "totals" (dict[str, pandas.DataFrame]): Total counts per flag.
- "by_month" (dict[str, pandas.DataFrame]): Monthly counts per flag.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flag_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">QC_flags</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes counts of flag variables for the entire station record.</span>

<span class="sd">    Args:</span>
<span class="sd">        QC_flags (list, optional): List of quality-control flag variable names.</span>
<span class="sd">            Defaults to `self.QC_flags`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing:</span>
<span class="sd">            - &quot;totals&quot; (dict[str, pandas.DataFrame]): Total counts per flag.</span>
<span class="sd">            - &quot;by_month&quot; (dict[str, pandas.DataFrame]): Monthly counts per flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;totals&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;by_month&quot;</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">QC_flags</span><span class="p">:</span>
        <span class="n">QC_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">QC_flags</span>
    <span class="k">for</span> <span class="n">flag_name</span> <span class="ow">in</span> <span class="n">QC_flags</span><span class="p">:</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="p">[</span><span class="n">flag_name</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span><span class="p">)</span>
        <span class="n">cat_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_categorical_flag_var</span><span class="p">(</span><span class="n">flag_name</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;totals&quot;</span><span class="p">][</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_count</span><span class="p">(</span><span class="n">cat_var</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;by_month&quot;</span><span class="p">][</span><span class="n">flag_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">by_month_count</span><span class="p">(</span><span class="n">cat_var</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.load_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_file</span><span class="p">(</span><span class="n">nc_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Loads a specific NetCDF file into the instance.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>nc_filename</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Filename of the NetCDF file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<details class="sets" open>
  <summary>Sets</summary>
  <p>self.nc: Loaded NetCDF file object.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads a specific NetCDF file into the instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        nc_filename (str): Filename of the NetCDF file.</span>

<span class="sd">    Sets:</span>
<span class="sd">        self.nc: Loaded NetCDF file object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nc_filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span><span class="p">[</span><span class="n">nc_filename</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_to_url</span><span class="p">(</span><span class="n">nc_filename</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.load_nc_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_nc_files</span><span class="p">(</span><span class="n">types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;realtime&#39;</span><span class="p">,</span> <span class="s1">&#39;historic&#39;</span><span class="p">,</span> <span class="s1">&#39;archive&#39;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Loads NetCDF files for the station.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>types</code></b>
                  (<code><span title="list">list</span></code>, default:
                      <code>[&#39;realtime&#39;, &#39;historic&#39;, &#39;archive&#39;]</code>
)
              –
              <div class="doc-md-description">
                <p>List of file categories to load. Defaults to
["realtime", "historic", "archive"].</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Dictionary of NetCDF file objects keyed by filename.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_nc_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;realtime&quot;</span><span class="p">,</span> <span class="s2">&quot;historic&quot;</span><span class="p">,</span> <span class="s2">&quot;archive&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads NetCDF files for the station.</span>

<span class="sd">    Args:</span>
<span class="sd">        types (list, optional): List of file categories to load. Defaults to</span>
<span class="sd">            [&quot;realtime&quot;, &quot;historic&quot;, &quot;archive&quot;].</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of NetCDF file objects keyed by filename.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nc_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nc_files</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.make_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_stats</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Computes station-level statistics.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>A dictionary containing:
- "flag_counts" (dict): Flag count summaries for the station.
- "deployments" (dict): Deployment summary statistics.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes station-level statistics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary containing:</span>
<span class="sd">            - &quot;flag_counts&quot; (dict): Flag count summaries for the station.</span>
<span class="sd">            - &quot;deployments&quot; (dict): Deployment summary statistics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;flag_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_counts</span><span class="p">()</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;deployments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deployment_summary</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.nc_file_summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nc_file_summary</span><span class="p">(</span><span class="n">nc_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Computes a summary for a given NetCDF file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>nc_filename</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Name of the NetCDF file.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Summary statistics for the file, including:
- "flag_counts" (dict): Flag count statistics.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">nc_file_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes a summary for a given NetCDF file.</span>

<span class="sd">    Args:</span>
<span class="sd">        nc_filename (str): Name of the NetCDF file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Summary statistics for the file, including:</span>
<span class="sd">            - &quot;flag_counts&quot; (dict): Flag count statistics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_file</span><span class="p">(</span><span class="n">nc_filename</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># - Currently have just one summary</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;flag_counts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_counts</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.ncstats.NcStats.total_count" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_count</span><span class="p">(</span><span class="n">cat_var</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Counts totals for a given categorical flag variable.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>cat_var</code></b>
                  (<code><span title="pandas.Categorical">Categorical</span></code>)
              –
              <div class="doc-md-description">
                <p>Categorical flag variable.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
              –
              <div class="doc-md-description">
                <p>pandas.DataFrame: DataFrame with counts grouped by category.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/ncstats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">total_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cat_var</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Counts totals for a given categorical flag variable.</span>

<span class="sd">    Args:</span>
<span class="sd">        cat_var (pandas.Categorical): Categorical flag variable.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: DataFrame with counts grouped by category.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;cnt&quot;</span><span class="p">:</span> <span class="n">cat_var</span><span class="p">})</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cat_var</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="cdippy.ndbc" class="doc doc-heading">
            <code>cdippy.ndbc</code>


</h2>

    <div class="doc doc-contents first">

        <p>Methods for working with NDBC</p>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cdippy.ndbc.get_stn_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_stn_info</span><span class="p">(</span><span class="n">wmo_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Work in progress, querying ndbc sos service.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/ndbc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_stn_info</span><span class="p">(</span><span class="n">wmo_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Work in progress, querying ndbc sos service.&quot;&quot;&quot;</span>
    <span class="n">qry</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">request</span><span class="p">,</span> <span class="n">service</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">outputformat</span><span class="p">,</span> <span class="n">describe_stn</span> <span class="o">+</span> <span class="n">wmo_id</span><span class="p">])</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;?&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sos_base</span><span class="p">,</span> <span class="n">qry</span><span class="p">])</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">load_et_root</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">url_utils</span><span class="o">.</span><span class="n">rfindt</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cdippy.ndbc.get_wmo_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_wmo_id</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Queries cdip wmo id table for a given station. Drops pickle file locally.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/ndbc.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_wmo_id</span><span class="p">(</span>
    <span class="n">stn</span><span class="p">,</span>
    <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Queries cdip wmo id table for a given station. Drops pickle file locally.&quot;&quot;&quot;</span>
    <span class="n">pkl_fl</span> <span class="o">=</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s2">&quot;/WMO_IDS.pkl&quot;</span> <span class="k">if</span> <span class="n">store</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pkl_fl</span> <span class="ow">or</span> <span class="n">now</span><span class="o">.</span><span class="n">minute</span> <span class="o">==</span> <span class="mi">23</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pkl_fl</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">cdip_base</span><span class="p">,</span> <span class="s2">&quot;wmo_ids&quot;</span><span class="p">])</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">url_utils</span><span class="o">.</span><span class="n">read_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="n">ids</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pkl_fl</span><span class="p">:</span>
            <span class="n">cdip_utils</span><span class="o">.</span><span class="n">pkl_dump</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">pkl_fl</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">pkl_load</span><span class="p">(</span><span class="n">pkl_fl</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ids</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="cdippy.plotting" class="doc doc-heading">
            <code>cdippy.plotting</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="cdippy.plotting.make_annual_hs_boxplot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_annual_hs_boxplot</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a boxplot of annual significant wave heights for a station.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>stn</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>A 5-char station identifier, e.g. '100p1'.</p>
              </div>
            </li>
            <li>
              <b><code>year</code></b>
                  (<code><span title="int">int</span></code>)
              –
              <div class="doc-md-description">
                <p>The year to plot.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>fig</code></b>(                  <code><span title="matplotlib.pyplot.Figure">Figure</span></code>
)              –
              <div class="doc-md-description">
                <p>A matplotlib.pyplot.Figure object for the created plot.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/plotting.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_annual_hs_boxplot</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a boxplot of annual significant wave heights for a station.</span>

<span class="sd">    Args:</span>
<span class="sd">        stn (str): A 5-char station identifier, e.g. &#39;100p1&#39;.</span>
<span class="sd">        year (int): The year to plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (Figure): A matplotlib.pyplot.Figure object for the created plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">plots</span><span class="o">.</span><span class="n">annual_hs_boxplot</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cdippy.plotting.make_compendium_plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_compendium_plot</span><span class="p">(</span><span class="n">stns</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">x_inch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>CDIP's classic compendium plot for multiple stations and parameters.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>stns</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>A comma-delimited list of 5-char station identifiers, e.g. '100p1,201p1'.</p>
              </div>
            </li>
            <li>
              <b><code>start</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Start time of data series formatted as 'yyyymm[ddHHMMss]' where 'ddHHMMss' are optional components.</p>
              </div>
            </li>
            <li>
              <b><code>end</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>End time of data series ('yyyymm[ddHHMMss]') If 'None' is provided, defaults to the current date and time.</p>
              </div>
            </li>
            <li>
              <b><code>params</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>A comma-delimited string of parameter names, e.g. 'waveHs,waveTp'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>fig</code></b>(                  <code><span title="matplotlib.pyplot.Figure">Figure</span></code>
)              –
              <div class="doc-md-description">
                <p>A matplotlib.pyplot.Figure object for the created plot.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/plotting.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_compendium_plot</span><span class="p">(</span>
    <span class="n">stns</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">x_inch</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;CDIP&#39;s classic compendium plot for multiple stations and parameters.</span>

<span class="sd">    Args:</span>
<span class="sd">        stns (str): A comma-delimited list of 5-char station identifiers, e.g. &#39;100p1,201p1&#39;.</span>
<span class="sd">        start (str): Start time of data series formatted as &#39;yyyymm[ddHHMMss]&#39; where &#39;ddHHMMss&#39; are optional components.</span>
<span class="sd">        end (str): End time of data series (&#39;yyyymm[ddHHMMss]&#39;) If &#39;None&#39; is provided, defaults to the current date and time.</span>
<span class="sd">        params (str): A comma-delimited string of parameter names, e.g. &#39;waveHs,waveTp&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (Figure): A matplotlib.pyplot.Figure object for the created plot.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">plots</span><span class="o">.</span><span class="n">compendium</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">stns</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x_inch</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="cdippy.plotting.make_sst_climatology_plot" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_sst_climatology_plot</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">x_inch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">y_inch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a plot of yearly climatology of sea surface temperature at a station for all years of available data.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>stn</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>A 5-char station identifier, e.g. '100p1'.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>fig</code></b>(                  <code><span title="matplotlib.pyplot.Figure">Figure</span></code>
)              –
              <div class="doc-md-description">
                <p>A matplotlib.pyplot.Figure object for the created plot.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>cdippy/plotting.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_sst_climatology_plot</span><span class="p">(</span>
    <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">x_inch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">y_inch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Figure</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a plot of yearly climatology of sea surface temperature at a station for all years of available data.</span>

<span class="sd">    Args:</span>
<span class="sd">        stn (str): A 5-char station identifier, e.g. &#39;100p1&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig (Figure): A matplotlib.pyplot.Figure object for the created plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">plots</span><span class="o">.</span><span class="n">sst_climatology</span><span class="o">.</span><span class="n">make_plot</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">x_inch</span><span class="p">,</span> <span class="n">y_inch</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="cdippy.spectra" class="doc doc-heading">
            <code>cdippy.spectra</code>


</h2>

    <div class="doc doc-contents first">

        <p>Author: Sarah Heim. (Some of which is a port of Corey Olfe's code)</p>
<p>This code was originally taken from the cdip_mobile site.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="cdippy.spectra.Spectra" class="doc doc-heading">
            <code>Spectra</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>









              <details class="quote">
                <summary>Source code in <code>cdippy/spectra.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Spectra</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;initializing Spectra. Meant for using methods to create array</span>
<span class="sd">            of Spectrum subClass objects</span>

<span class="sd">        :ivar specArr: array of Spectrum subClass objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_spectraNum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;return the number of objects (spectrum) in the specArr&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Spectra is an array of Spectrum(s)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Spectra is an array of </span><span class="si">{0}</span><span class="s2"> Spectrum(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_spectraNum</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_spectraType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns the type of Class of the first object in specArr,</span>
<span class="sd">        all should be the same i.e. Spectrum_64band&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectraNum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_bandSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns the size (number of freq/bands) of the spectrum in spectra&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectraNum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">whichSpecClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the type subClass of Spectrum is appropriate according length passed</span>
<span class="sd">        i.e. Spectrum_64band</span>
<span class="sd">        :var int lenght: length/count of the number of frequencies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">specObjs</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sObj</span> <span class="ow">in</span> <span class="n">specObjs</span><span class="p">:</span>
            <span class="n">objNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sObj</span><span class="p">()</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">objNum</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">sObj</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># def get_spectrumArr_from_StnData(self, stn, start, end):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_spectrumArr_fromQuery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataDict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        specArr is empty. Create Spectrum objects and put in specArr</span>

<span class="sd">        :var dataDict: dictionary (output from cdippy.stndata query)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bandNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">specCls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whichSpecClass</span><span class="p">(</span><span class="n">bandNum</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">]):</span>
            <span class="c1"># create Spectrum object of appropriate type for each time</span>
            <span class="c1"># i.e.: spec = Spectrum_64band(stn)</span>
            <span class="n">spec</span> <span class="o">=</span> <span class="n">specCls</span><span class="p">()</span>
            <span class="n">spec</span><span class="o">.</span><span class="n">set_specAtts</span><span class="p">(</span><span class="n">dataDict</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">specArr_ToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output the specArr as a dictionary with keys like waveA1Value, waveEnergyDensity etc.&quot;&quot;&quot;</span>
        <span class="n">newDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">newDict</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;waveTime&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waveA1Value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waveA2Value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waveB1Value&quot;</span><span class="p">,</span>
            <span class="s2">&quot;waveB2Value&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">lists</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">:</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">wTime</span><span class="p">)</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">)</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dMean</span><span class="p">)</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">a1</span><span class="p">)</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">a2</span><span class="p">)</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">b2</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;waveCheckFactor&quot;</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">:</span>
                <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">)</span>

        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">])</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">])</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">])</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">])</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">])</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">])</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;waveCheckFactor&quot;</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">:</span>
            <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">newDict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">redist_specArr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objName</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Will redistribute spectrum if necessary (if different type)</span>

<span class="sd">        :var int objName: name of the subClass to redistribute to. .i.e. ``Spectrum_9band``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectraType</span><span class="p">()</span> <span class="o">!=</span> <span class="n">objName</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">redistribute_sp</span><span class="p">(</span><span class="n">objName</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>initializing Spectra. Meant for using methods to create array
    of Spectrum subClass objects</p>
<p>:ivar specArr: array of Spectrum subClass objects</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;initializing Spectra. Meant for using methods to create array</span>
<span class="sd">        of Spectrum subClass objects</span>

<span class="sd">    :ivar specArr: array of Spectrum subClass objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.__str__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__str__</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Spectra is an array of Spectrum(s)</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Spectra is an array of Spectrum(s)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Spectra is an array of </span><span class="si">{0}</span><span class="s2"> Spectrum(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_spectraNum</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.get_bandSize" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_bandSize</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>returns the size (number of freq/bands) of the spectrum in spectra</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_bandSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns the size (number of freq/bands) of the spectrum in spectra&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectraNum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.get_spectraNum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spectraNum</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>return the number of objects (spectrum) in the specArr</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_spectraNum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;return the number of objects (spectrum) in the specArr&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.get_spectraType" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spectraType</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>returns the type of Class of the first object in specArr,
all should be the same i.e. Spectrum_64band</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_spectraType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns the type of Class of the first object in specArr,</span>
<span class="sd">    all should be the same i.e. Spectrum_64band&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectraNum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.redist_specArr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">redist_specArr</span><span class="p">(</span><span class="n">objName</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Will redistribute spectrum if necessary (if different type)</p>
<p>:var int objName: name of the subClass to redistribute to. .i.e. <code>Spectrum_9band</code></p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">redist_specArr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">objName</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Will redistribute spectrum if necessary (if different type)</span>

<span class="sd">    :var int objName: name of the subClass to redistribute to. .i.e. ``Spectrum_9band``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_spectraType</span><span class="p">()</span> <span class="o">!=</span> <span class="n">objName</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">redistribute_sp</span><span class="p">(</span><span class="n">objName</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.set_spectrumArr_fromQuery" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_spectrumArr_fromQuery</span><span class="p">(</span><span class="n">dataDict</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>specArr is empty. Create Spectrum objects and put in specArr</p>
<p>:var dataDict: dictionary (output from cdippy.stndata query)</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_spectrumArr_fromQuery</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataDict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    specArr is empty. Create Spectrum objects and put in specArr</span>

<span class="sd">    :var dataDict: dictionary (output from cdippy.stndata query)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bandNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">specCls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whichSpecClass</span><span class="p">(</span><span class="n">bandNum</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">e</span><span class="p">,</span> <span class="n">ep</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataDict</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">]):</span>
        <span class="c1"># create Spectrum object of appropriate type for each time</span>
        <span class="c1"># i.e.: spec = Spectrum_64band(stn)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">specCls</span><span class="p">()</span>
        <span class="n">spec</span><span class="o">.</span><span class="n">set_specAtts</span><span class="p">(</span><span class="n">dataDict</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.specArr_ToDict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">specArr_ToDict</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Output the specArr as a dictionary with keys like waveA1Value, waveEnergyDensity etc.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">specArr_ToDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Output the specArr as a dictionary with keys like waveA1Value, waveEnergyDensity etc.&quot;&quot;&quot;</span>
    <span class="n">newDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">newDict</span>

    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;waveTime&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveA1Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveA2Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveB1Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveB2Value&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">lists</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">lists</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">specArr</span><span class="p">:</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">wTime</span><span class="p">)</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">)</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">dMean</span><span class="p">)</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">a1</span><span class="p">)</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">a2</span><span class="p">)</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">b1</span><span class="p">)</span>
        <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">b2</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;waveCheckFactor&quot;</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">:</span>
            <span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">)</span>

    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">])</span>
    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">])</span>
    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">])</span>
    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">])</span>
    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">])</span>
    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">])</span>
    <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;waveCheckFactor&quot;</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">:</span>
        <span class="n">newDict</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lists</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">newDict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectra.whichSpecClass" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">whichSpecClass</span><span class="p">(</span><span class="n">length</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Return the type subClass of Spectrum is appropriate according length passed
i.e. Spectrum_64band
:var int lenght: length/count of the number of frequencies</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">whichSpecClass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the type subClass of Spectrum is appropriate according length passed</span>
<span class="sd">    i.e. Spectrum_64band</span>
<span class="sd">    :var int lenght: length/count of the number of frequencies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">specObjs</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="o">.</span><span class="n">__subclasses__</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sObj</span> <span class="ow">in</span> <span class="n">specObjs</span><span class="p">:</span>
        <span class="n">objNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sObj</span><span class="p">()</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">objNum</span> <span class="o">==</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sObj</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cdippy.spectra.Spectrum" class="doc doc-heading">
            <code>Spectrum</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="object">object</span></code></p>









              <details class="quote">
                <summary>Source code in <code>cdippy/spectra.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Spectrum</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="c1"># return &quot;Station %s: \n\tstart: %s \n\tend : %s&quot; % (self.stn, self.start.isoformat(), self.end.isoformat())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_specAtts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set spectra attributes from cdippy.stndata query</span>

<span class="sd">        :var mArr query: multi-dimentional array returned from cdippy.stndata</span>
<span class="sd">        :var int i: index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wTime</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dMean</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ener_dens</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b1</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b2</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;waveCheckFactor&quot;</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">set_FreqBands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">sz</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Makes array of frequencies</span>
<span class="sd">        :var int num: frequency or bandwith?</span>
<span class="sd">        :var int sz: size, number of bands</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">num</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">num</span><span class="p">]</span> <span class="o">*</span> <span class="n">sz</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="c1"># return list(map(lambda x: x*num, range(1, sz+1)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">freq_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns array of tuples of all the (low,high) frequencies;</span>
<span class="sd">        a.k.a.bots/tops&quot;&quot;&quot;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">):</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># if i&lt; 25: print(i, f, b)</span>
            <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span> <span class="o">-</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">arr</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">recip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns INTEGER of reciprocal of number.</span>
<span class="sd">        Specifically for converting frequency (float) to period(integer)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">peri_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns array of tuples of all the (low,high) periods&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recip</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoffs</span><span class="p">()))</span>

    <span class="c1"># def get_center_periods(self):</span>
    <span class="c1">#     return list(map(lambda x: &quot;%.1f&quot; % (1/x), self.freq))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ma_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marray</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :var str marray: string name of attribute that contains a masked array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marray</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_Energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;units:meters**2 per bandwidth.</span>
<span class="sd">        sum(get_energy) is Total Energy&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ener_dens</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_SigWaveHt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;units: meters&quot;&quot;&quot;</span>
        <span class="c1"># return list(map(lambda x: self.calc_Hs(x), self.get_Energy()))</span>
        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Hs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_Energy</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_Tp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># index with the most energy</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_SigWaveHt</span><span class="p">()))</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_Dp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># index with the most energy</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_SigWaveHt</span><span class="p">()))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calc_Hs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;returns the square root of energy x 4&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">energy</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">total_Hs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;square root of Total Energy x 4&quot;&quot;&quot;</span>
        <span class="c1"># return self.calc_Hs(np.sum(self.get_Energy()))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Hs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_Energy</span><span class="p">()))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">redistribute_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specInstClass</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        translation of Corey&#39;s redistribute_sp code:</span>
<span class="sd">        c  Subroutine that redistributes a spectrum into a new spectral layout.</span>

<span class="sd">        :var specInstClass: the class to redistribute to can be instance or name of Class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># c--   Initialize the new spectral dist (redist_sp)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="n">specInstClass</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">redist_sp</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">reBands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">redist_sp</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">wTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wTime</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reBands</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">redist_botsTops</span> <span class="o">=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">freq_cutoffs</span><span class="p">()</span>
        <span class="n">orig_botsTops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoffs</span><span class="p">()</span>

        <span class="c1"># c--   Do the business - loop over the new bins, adding in each of the original</span>
        <span class="c1"># c--   spectral bands to the appropriate bin. Partition bands where necessary.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reBands</span><span class="p">):</span>
            <span class="n">cos_sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sin_sum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">miss_dir</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">rBot</span><span class="p">,</span> <span class="n">rTop</span> <span class="o">=</span> <span class="n">redist_botsTops</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">redist_botsTops</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># print(&#39;%s: (%.3f, %.3f)&#39; % (i, rBot, rTop))</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">):</span>
                <span class="c1"># minor re-write of bot/top</span>
                <span class="c1"># c--   If the full band falls into the current bin, add the entire contents</span>
                <span class="c1"># c--   If the bottom of the band falls in the bin, add in the appropriate portion</span>
                <span class="c1"># c--   If the top of the band falls in the bin, add in the appropriate portion</span>
                <span class="c1"># c--   If the middle of the band falls in the bin, add in the appropriate portion</span>
                <span class="n">oBot</span><span class="p">,</span> <span class="n">oTop</span> <span class="o">=</span> <span class="n">orig_botsTops</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">orig_botsTops</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">bot</span> <span class="o">=</span> <span class="n">rBot</span> <span class="k">if</span> <span class="n">rBot</span> <span class="o">&gt;=</span> <span class="n">oBot</span> <span class="k">else</span> <span class="n">oBot</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">rTop</span> <span class="k">if</span> <span class="n">rTop</span> <span class="o">&lt;=</span> <span class="n">oTop</span> <span class="k">else</span> <span class="n">oTop</span>
                <span class="k">if</span> <span class="n">bot</span> <span class="o">&lt;</span> <span class="n">top</span><span class="p">:</span>
                    <span class="c1"># Moved band_calcs here:</span>
                    <span class="c1"># c  Helper for REDISTRIBUTE_SP; adds components of original spectral layout</span>
                    <span class="c1"># c  into the redistributed layout, weighting by energy</span>
                    <span class="n">curr_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">bot</span><span class="p">)</span>
                    <span class="c1"># [redist_sp, miss_dir, sin_sum, cos_sum] = self.band_calcs(redist_sp, curr_energy, sin_sum, cos_sum, miss_dir, i, j)</span>
                    <span class="k">if</span> <span class="n">curr_energy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span>
                        <span class="c1"># print(&#39;\tredist(%.3f, %.3f) new(%.3f, %.3f), %f, %f, %f&#39; %</span>
                        <span class="c1"># (oBot, oTop, bot, top, self.ener_dens[j],</span>
                        <span class="c1"># curr_energy, redist_sp.ener_dens[i]))</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">miss_dir</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="n">sin_sum</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            <span class="p">)</span>
                            <span class="n">cos_sum</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                                <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                            <span class="p">)</span>

            <span class="c1"># c--   Calculate direction and calc ener_dens once bin is complete</span>
            <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">miss_dir</span><span class="p">:</span>
                    <span class="n">sin_avg</span> <span class="o">=</span> <span class="n">sin_sum</span> <span class="o">/</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">cos_avg</span> <span class="o">=</span> <span class="n">cos_sum</span> <span class="o">/</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">sin_avg</span><span class="p">,</span> <span class="n">cos_avg</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">360</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># c--   Normalize once energy redistributed</span>
            <span class="c1"># c  Subroutine that normalizes the coefficients in a sp_data_block. Direction</span>
            <span class="c1"># c  is set to -1 for any band in which the coeffs can&#39;t be normalized</span>
            <span class="c1"># c  by energy.</span>
            <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">2.55</span><span class="p">:</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.55</span>
                <span class="n">max_coeff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">min_coeff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">max_coeff</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">min_coeff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">return</span> <span class="n">redist_sp</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.calc_Hs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calc_Hs</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>returns the square root of energy x 4</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calc_Hs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns the square root of energy x 4&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">energy</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="mi">4</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.freq_cutoffs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">freq_cutoffs</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>returns array of tuples of all the (low,high) frequencies;
a.k.a.bots/tops</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">freq_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns array of tuples of all the (low,high) frequencies;</span>
<span class="sd">    a.k.a.bots/tops&quot;&quot;&quot;</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># if i&lt; 25: print(i, f, b)</span>
        <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f</span> <span class="o">-</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f</span> <span class="o">+</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.get_Energy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_Energy</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>units:meters**2 per bandwidth.
sum(get_energy) is Total Energy</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_Energy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;units:meters**2 per bandwidth.</span>
<span class="sd">    sum(get_energy) is Total Energy&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ener_dens</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.get_SigWaveHt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_SigWaveHt</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>units: meters</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_SigWaveHt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;units: meters&quot;&quot;&quot;</span>
    <span class="c1"># return list(map(lambda x: self.calc_Hs(x), self.get_Energy()))</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Hs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_Energy</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.ma_to_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ma_to_list</span><span class="p">(</span><span class="n">marray</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>:var str marray: string name of attribute that contains a masked array</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ma_to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :var str marray: string name of attribute that contains a masked array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marray</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.peri_cutoffs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">peri_cutoffs</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>returns array of tuples of all the (low,high) periods</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">peri_cutoffs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns array of tuples of all the (low,high) periods&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recip</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoffs</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.recip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recip</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>returns INTEGER of reciprocal of number.
Specifically for converting frequency (float) to period(integer)</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">recip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns INTEGER of reciprocal of number.</span>
<span class="sd">    Specifically for converting frequency (float) to period(integer)&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.redistribute_sp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">redistribute_sp</span><span class="p">(</span><span class="n">specInstClass</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>translation of Corey's redistribute_sp code:
c  Subroutine that redistributes a spectrum into a new spectral layout.</p>
<p>:var specInstClass: the class to redistribute to can be instance or name of Class</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">redistribute_sp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specInstClass</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    translation of Corey&#39;s redistribute_sp code:</span>
<span class="sd">    c  Subroutine that redistributes a spectrum into a new spectral layout.</span>

<span class="sd">    :var specInstClass: the class to redistribute to can be instance or name of Class</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># c--   Initialize the new spectral dist (redist_sp)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">MODULE</span><span class="p">,</span> <span class="n">specInstClass</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">redist_sp</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="n">reBands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">redist_sp</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">wTime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wTime</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">reBands</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">reBands</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="n">redist_botsTops</span> <span class="o">=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">freq_cutoffs</span><span class="p">()</span>
    <span class="n">orig_botsTops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_cutoffs</span><span class="p">()</span>

    <span class="c1"># c--   Do the business - loop over the new bins, adding in each of the original</span>
    <span class="c1"># c--   spectral bands to the appropriate bin. Partition bands where necessary.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">reBands</span><span class="p">):</span>
        <span class="n">cos_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">sin_sum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">miss_dir</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">rBot</span><span class="p">,</span> <span class="n">rTop</span> <span class="o">=</span> <span class="n">redist_botsTops</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">redist_botsTops</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># print(&#39;%s: (%.3f, %.3f)&#39; % (i, rBot, rTop))</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">ob</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">):</span>
            <span class="c1"># minor re-write of bot/top</span>
            <span class="c1"># c--   If the full band falls into the current bin, add the entire contents</span>
            <span class="c1"># c--   If the bottom of the band falls in the bin, add in the appropriate portion</span>
            <span class="c1"># c--   If the top of the band falls in the bin, add in the appropriate portion</span>
            <span class="c1"># c--   If the middle of the band falls in the bin, add in the appropriate portion</span>
            <span class="n">oBot</span><span class="p">,</span> <span class="n">oTop</span> <span class="o">=</span> <span class="n">orig_botsTops</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">orig_botsTops</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">bot</span> <span class="o">=</span> <span class="n">rBot</span> <span class="k">if</span> <span class="n">rBot</span> <span class="o">&gt;=</span> <span class="n">oBot</span> <span class="k">else</span> <span class="n">oBot</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">rTop</span> <span class="k">if</span> <span class="n">rTop</span> <span class="o">&lt;=</span> <span class="n">oTop</span> <span class="k">else</span> <span class="n">oTop</span>
            <span class="k">if</span> <span class="n">bot</span> <span class="o">&lt;</span> <span class="n">top</span><span class="p">:</span>
                <span class="c1"># Moved band_calcs here:</span>
                <span class="c1"># c  Helper for REDISTRIBUTE_SP; adds components of original spectral layout</span>
                <span class="c1"># c  into the redistributed layout, weighting by energy</span>
                <span class="n">curr_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">top</span> <span class="o">-</span> <span class="n">bot</span><span class="p">)</span>
                <span class="c1"># [redist_sp, miss_dir, sin_sum, cos_sum] = self.band_calcs(redist_sp, curr_energy, sin_sum, cos_sum, miss_dir, i, j)</span>
                <span class="k">if</span> <span class="n">curr_energy</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span>
                    <span class="c1"># print(&#39;\tredist(%.3f, %.3f) new(%.3f, %.3f), %f, %f, %f&#39; %</span>
                    <span class="c1"># (oBot, oTop, bot, top, self.ener_dens[j],</span>
                    <span class="c1"># curr_energy, redist_sp.ener_dens[i]))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">miss_dir</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                        <span class="n">sin_sum</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="p">)</span>
                        <span class="n">cos_sum</span> <span class="o">+=</span> <span class="n">curr_energy</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                            <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="p">)</span>

        <span class="c1"># c--   Calculate direction and calc ener_dens once bin is complete</span>
        <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">miss_dir</span><span class="p">:</span>
                <span class="n">sin_avg</span> <span class="o">=</span> <span class="n">sin_sum</span> <span class="o">/</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">cos_avg</span> <span class="o">=</span> <span class="n">cos_sum</span> <span class="o">/</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">sin_avg</span><span class="p">,</span> <span class="n">cos_avg</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">360</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">bandwidth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># c--   Normalize once energy redistributed</span>
        <span class="c1"># c  Subroutine that normalizes the coefficients in a sp_data_block. Direction</span>
        <span class="c1"># c  is set to -1 for any band in which the coeffs can&#39;t be normalized</span>
        <span class="c1"># c  by energy.</span>
        <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;check&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">ener_dens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">2.55</span><span class="p">:</span>
                    <span class="n">redist_sp</span><span class="o">.</span><span class="n">check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.55</span>
            <span class="n">max_coeff</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">min_coeff</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">a1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">redist_sp</span><span class="o">.</span><span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">max_coeff</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">min_coeff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">redist_sp</span><span class="o">.</span><span class="n">dMean</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">redist_sp</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.set_FreqBands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_FreqBands</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">sz</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Makes array of frequencies
:var int num: frequency or bandwith?
:var int sz: size, number of bands</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_FreqBands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">sz</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Makes array of frequencies</span>
<span class="sd">    :var int num: frequency or bandwith?</span>
<span class="sd">    :var int sz: size, number of bands</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">num</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bandwidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="n">num</span><span class="p">]</span> <span class="o">*</span> <span class="n">sz</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.set_specAtts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_specAtts</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Set spectra attributes from cdippy.stndata query</p>
<p>:var mArr query: multi-dimentional array returned from cdippy.stndata
:var int i: index</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">set_specAtts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set spectra attributes from cdippy.stndata query</span>

<span class="sd">    :var mArr query: multi-dimentional array returned from cdippy.stndata</span>
<span class="sd">    :var int i: index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wTime</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveTime&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dMean</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ener_dens</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveA1Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">b1</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveB1Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveA2Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">b2</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveB2Value&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">check</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;waveCheckFactor&quot;</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.spectra.Spectrum.total_Hs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">total_Hs</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>square root of Total Energy x 4</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/spectra.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">total_Hs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;square root of Total Energy x 4&quot;&quot;&quot;</span>
    <span class="c1"># return self.calc_Hs(np.sum(self.get_Energy()))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Hs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_Energy</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="cdippy.stndata" class="doc doc-heading">
            <code>cdippy.stndata</code>


</h2>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="cdippy.stndata.StnData" class="doc doc-heading">
            <code>StnData</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="CDIPnc (cdippy.cdipnc.CDIPnc)" href="#cdippy.cdipnc.CDIPnc">CDIPnc</a></code></p>


        <p>Returns data and metadata for the specified station.</p>
<p>This class merges data from multiple CDIP netCDF files to
produce a single dictionary with keys of the requested variables.
Each key corresponds to a numpy masked array.</p>
<h5 id="cdippy.stndata.StnData--methods">METHODS</h5>
<p>get_series(start, end, vrs)
    Returns data for a station given start date, end date and a
    list of variables.
get_parameters(start, end)
    Calls get_series with vrs set to parameter variables.
get_spectra(start, end)
    Calls get_series with vrs set to spectrum variables.
get_xyz
    Calls get_series with vrs set to xyz variables.
get_stn_meta
    Returns all station meta variables.
get_nc_files
    Returns a dictionary of all this station's netCDF files.
get_target_times
    Returns a 2-tuple of timestamps, an interval corresponding
    to  n records to the right or left of target_timestamp.</p>








              <details class="quote">
                <summary>Source code in <code>cdippy/stndata.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StnData</span><span class="p">(</span><span class="n">CDIPnc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns data and metadata for the specified station.</span>

<span class="sd">    This class merges data from multiple CDIP netCDF files to</span>
<span class="sd">    produce a single dictionary with keys of the requested variables.</span>
<span class="sd">    Each key corresponds to a numpy masked array.</span>

<span class="sd">    METHODS</span>
<span class="sd">    -------</span>
<span class="sd">    get_series(start, end, vrs)</span>
<span class="sd">        Returns data for a station given start date, end date and a</span>
<span class="sd">        list of variables.</span>
<span class="sd">    get_parameters(start, end)</span>
<span class="sd">        Calls get_series with vrs set to parameter variables.</span>
<span class="sd">    get_spectra(start, end)</span>
<span class="sd">        Calls get_series with vrs set to spectrum variables.</span>
<span class="sd">    get_xyz</span>
<span class="sd">        Calls get_series with vrs set to xyz variables.</span>
<span class="sd">    get_stn_meta</span>
<span class="sd">        Returns all station meta variables.</span>
<span class="sd">    get_nc_files</span>
<span class="sd">        Returns a dictionary of all this station&#39;s netCDF files.</span>
<span class="sd">    get_target_times</span>
<span class="sd">        Returns a 2-tuple of timestamps, an interval corresponding</span>
<span class="sd">        to  n records to the right or left of target_timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nc_file_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;historic&quot;</span><span class="p">,</span>
        <span class="s2">&quot;archive&quot;</span><span class="p">,</span>
        <span class="s2">&quot;predeploy&quot;</span><span class="p">,</span>
        <span class="s2">&quot;moored&quot;</span><span class="p">,</span>
        <span class="s2">&quot;offsite&quot;</span><span class="p">,</span>
        <span class="s2">&quot;recovered&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># Commonly requested sets of variables</span>
    <span class="n">parameter_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;waveHs&quot;</span><span class="p">,</span> <span class="s2">&quot;waveTp&quot;</span><span class="p">,</span> <span class="s2">&quot;waveDp&quot;</span><span class="p">,</span> <span class="s2">&quot;waveTa&quot;</span><span class="p">]</span>
    <span class="n">xyz_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xyzXDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzYDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">]</span>
    <span class="n">gps_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gpsLatitude&quot;</span><span class="p">,</span> <span class="s2">&quot;gpsLongitude&quot;</span><span class="p">,</span> <span class="s2">&quot;gpsStatusFlags&quot;</span><span class="p">]</span>
    <span class="n">spectrum_vars</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;waveEnergyDensity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveMeanDirection&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveA1Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveB1Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveA2Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveB2Value&quot;</span><span class="p">,</span>
        <span class="s2">&quot;waveCheckFactor&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">meta_vars</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;metaStationName&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metaDeployLatitude&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metaDeployLongitude&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metaWaterDepth&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metaDeclination&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">meta_attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;wmo_id&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lat_min&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lat_max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lat_units&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lat_resolution&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lon_min&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lon_max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lon_units&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_lon_resolution&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_vertical_min&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_vertical_max&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_vertical_units&quot;</span><span class="p">,</span>
        <span class="s2">&quot;geospatial_vertical_resolution&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_coverage_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_coverage_end&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date_created&quot;</span><span class="p">,</span>
        <span class="s2">&quot;date_modified&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">pub_set</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">vrs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">deploy_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        stn : str</span>
<span class="sd">           Can be in 2, 3 or 5 char format e.g. 28, 028, 028p2</span>
<span class="sd">        data_dir : str [optional]</span>
<span class="sd">            Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">            of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">        org: str</span>
<span class="sd">            (Organization) Values are: cdip|ww3|external</span>
<span class="sd">        deploy_num : int [optional]</span>
<span class="sd">            Supply this to access specific station deployment data.</span>
<span class="sd">            Must be &gt;= 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">org</span> <span class="o">=</span> <span class="n">org</span>

        <span class="c1"># Accept numbers for cdip stations</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">stn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;p1&quot;</span>

        <span class="c1"># Initialize nc file used for meta information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="o">=</span> <span class="n">deploy_num</span>
        <span class="k">if</span> <span class="n">deploy_num</span><span class="p">:</span>
            <span class="c1"># Check all active datasets in this order p3 -&gt; p2 -&gt; p1 -&gt; p0</span>
            <span class="n">p_lookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([[</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
            <span class="n">__found_active_meta</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">p_lookup</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Active</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="n">p_lookup</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                    <span class="n">__found_active_meta</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">__found_active_meta</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">historic</span> <span class="o">=</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="o">=</span> <span class="n">Realtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stn_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dict of station meta data.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">set_request_info</span><span class="p">(</span><span class="n">vrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_vars</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
                <span class="n">result</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_parameters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
        <span class="n">apply_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">target_records</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calls get_series to return wave parameters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vars</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">,</span> <span class="n">target_records</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_xyz</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calls get_series to return displacement data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_vars</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_spectra</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
        <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">target_records</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">force_64bands</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calls get_series to return spectral data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span>
            <span class="n">start</span><span class="p">,</span>
            <span class="n">end</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_vars</span><span class="p">,</span>
            <span class="n">pub_set</span><span class="p">,</span>
            <span class="n">apply_mask</span><span class="p">,</span>
            <span class="n">target_records</span><span class="p">,</span>
            <span class="n">force_64bands</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_series</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">vrs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target_records</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">force_64bands</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dict of data between start and end dates with specified quality.</span>

<span class="sd">        PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        start : str or datetime [optional] : default Jan 1, 1975</span>
<span class="sd">            Start time of data request (UTC). If provided as a string must</span>
<span class="sd">            be in the format Y-m-d H:M:S where Y is 4 chars and all others</span>
<span class="sd">            are 2 chars. Ex. &#39;2020-03-30 19:32:56&#39;.</span>
<span class="sd">        end : str or datetime [optional] : default now</span>
<span class="sd">            End time of data request (UTC). If not supplied defaults to now.</span>
<span class="sd">        vrs : list [optional] : default [&#39;waveHs&#39;]</span>
<span class="sd">            A list of the names of variables to retrieve. They all must start</span>
<span class="sd">            with the same prefix, e.g. [&#39;waveHs&#39;, &#39;waveTp&#39;, &#39;waveDp&#39;]</span>
<span class="sd">        pub_set: str [optional] values = public|nonpub|all</span>
<span class="sd">            Filters data based on data quality flags.</span>
<span class="sd">        apply_mask: bool [optional] default True</span>
<span class="sd">            Removes values from the masked array that have a mask value of True.</span>
<span class="sd">            Ex. If nonpub data is requested and apply_mask is False, the returned</span>
<span class="sd">            array will contain both public and nonpublic data (although public</span>
<span class="sd">            data records will have the mask value set to True). If apply_mask</span>
<span class="sd">            is set to True, only nonpub records will be returned.</span>
<span class="sd">        target_records: int [optional]</span>
<span class="sd">            If start is specified and end is None, this will specify the number</span>
<span class="sd">            of additional records to return closest to start.</span>
<span class="sd">        force_64bands: bool [optional]</span>
<span class="sd">            For the case in which all spectra returned are mk4 100 band format,</span>
<span class="sd">            force the conversion to 64bands. Mixed formats are always returned in mk3</span>
<span class="sd">            64 band format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">vrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vars</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Target time</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">ts_I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_timespan</span><span class="p">(</span>
                <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">target_records</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ts_I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">timestamp_to_datetime</span><span class="p">(</span><span class="n">ts_I</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">timestamp_to_datetime</span><span class="p">(</span><span class="n">ts_I</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Use default 3 days back</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pub_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>

        <span class="k">if</span> <span class="n">apply_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">force_64bands</span> <span class="o">=</span> <span class="n">force_64bands</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_request_info</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">vrs</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;xyz&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_xyz_request</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;xyz&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_active_request</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_request</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_active_request</span><span class="p">(</span><span class="s2">&quot;rt&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__aggregate_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dict2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dict of data combined from two dictionaries. Dict1 has oldest data.</span>
<span class="sd">        All the other __merge methods end up using this method.</span>

<span class="sd">        This method also redistributes 100 band spectra to 64 band format if 1) both</span>
<span class="sd">        formats are present in dict1 and dict2 or 2) the force_64bands option is True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Union the keys to make sure we check each one</span>
        <span class="n">ukeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># Determine if there are any spectra vars to redistribute</span>
        <span class="n">svars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum_vars</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ukeys</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svars</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">svars</span><span class="p">))</span>  <span class="c1"># retrieves an element from the set</span>
            <span class="n">shape1</span> <span class="o">=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">shape2</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">100</span> <span class="ow">in</span> <span class="n">shapes</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_64bands</span> <span class="ow">or</span> <span class="mi">64</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">):</span>
                <span class="n">dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="n">spectra_obj</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                        <span class="n">spectra_obj</span><span class="o">.</span><span class="n">set_spectrumArr_fromQuery</span><span class="p">(</span><span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">spectra_obj</span><span class="o">.</span><span class="n">redist_specArr</span><span class="p">(</span><span class="s2">&quot;Spectrum_64band&quot;</span><span class="p">)</span>
                        <span class="n">redistributed_dict</span> <span class="o">=</span> <span class="n">spectra_obj</span><span class="o">.</span><span class="n">specArr_ToDict</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_vars</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                                <span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">redistributed_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
        <span class="c1"># Concatenate the variables</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ukeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__merge_archive_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cdip_nc</span><span class="p">:</span> <span class="n">CDIPnc</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">file_start_stamp</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_coverage_start</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">file_end_stamp</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_coverage_end</span><span class="p">())</span>
        <span class="n">file_timespan</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">file_start_stamp</span><span class="p">,</span> <span class="n">file_end_stamp</span><span class="p">)</span>
        <span class="n">request_timespan</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request_timespan</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">file_timespan</span><span class="p">):</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
            <span class="n">tmp_result</span> <span class="o">=</span> <span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">tmp_result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">file_start_stamp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__merge_xyz_helper</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">cdip_nc</span><span class="p">:</span> <span class="n">CDIPnc</span><span class="p">,</span> <span class="n">request_timespan</span><span class="p">:</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">):</span>
        <span class="c1"># Try the next file if it is without xyz data</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
        <span class="c1"># Try the next file if start_stamp cannot be calculated</span>
        <span class="n">start_stamp</span> <span class="o">=</span> <span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_xyz_timestamp</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">end_stamp</span> <span class="o">=</span> <span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_xyz_timestamp</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_stamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
        <span class="n">file_timespan</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">start_stamp</span><span class="p">,</span> <span class="n">end_stamp</span><span class="p">)</span>
        <span class="c1"># Add data if request timespan overlaps data timespan</span>
        <span class="k">if</span> <span class="n">request_timespan</span><span class="o">.</span><span class="n">overlap</span><span class="p">(</span><span class="n">file_timespan</span><span class="p">):</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
            <span class="n">cdip_nc</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
            <span class="n">tmp_result</span> <span class="o">=</span> <span class="n">cdip_nc</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">tmp_result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Duplicate records may exist after merge_ routines. This removes them.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">time_dimension_name</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
            <span class="n">time_values</span><span class="p">,</span> <span class="n">indices_of_unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
                <span class="n">data_dict</span><span class="p">[</span><span class="n">time_dimension_name</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">result</span><span class="p">[</span><span class="n">time_dimension_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_values</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">time_dimension_name</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indices_of_unique_values</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data_dict</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__merge_xyz_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge xyz data from realtime and archive nc files.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;xyzData&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xyzXDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzYDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">]</span>
        <span class="n">request_timespan</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">)</span>
        <span class="n">arch_file_used</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">rt_file_used</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># First get realtime data if it exists</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">RealtimeXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rt</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rt_file_used</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_xyz_helper</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="n">request_timespan</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="c1"># If the request start time is more recent than the realtime</span>
        <span class="c1"># start time, no need to look in the archives</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">&gt;</span> <span class="n">start_stamp</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="c1"># Second, look in archive files for data</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">arch_file_used</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_xyz_helper</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">request_timespan</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="c1"># Break if file start stamp is greater than request end stamp</span>
            <span class="k">if</span> <span class="n">start_stamp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">rt_file_used</span> <span class="ow">and</span> <span class="n">arch_file_used</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__merge_active_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc_class_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rt&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns data for a given request across active datasets.</span>

<span class="sd">        When deploy_num is supplied all files (active and archive)</span>
<span class="sd">        are checked for data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sorted_datasets</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">active_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">num_files_used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">sorted_datasets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nc_class_type</span> <span class="o">==</span> <span class="s2">&quot;xyz&quot;</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">ActiveXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">Active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;moored&quot;</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">a</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
                <span class="n">a</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
                <span class="n">a</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
                <span class="n">a</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
                <span class="n">a</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
                <span class="n">tmp_result</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">tmp_result</span><span class="p">)</span>
                <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">num_files_used</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__merge_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns data for given request across realtime and historic files&quot;&quot;&quot;</span>

        <span class="n">num_files_used</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span>
        <span class="c1"># Note that we are assuming that waveTime will work for every time dim.</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;waveTime&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">:</span>
            <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">r</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
            <span class="n">r</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
            <span class="n">r</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
            <span class="n">r</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
            <span class="n">r</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
            <span class="n">rt</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

        <span class="n">ht</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span>
        <span class="c1"># Historic file contains public data</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">h</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;waveTime&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;public&quot;</span>
        <span class="p">):</span>
            <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">h</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
            <span class="n">h</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
            <span class="n">h</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
            <span class="n">h</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
            <span class="n">h</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">rt</span><span class="p">)</span>

        <span class="c1"># Check Archive files if requesting non-pub data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">!=</span> <span class="s2">&quot;public&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
                <span class="n">ar</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_archive_helper</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
                <span class="c1"># Break if file start stamp is greater than request end stamp</span>
                <span class="k">if</span> <span class="n">start_stamp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">if</span> <span class="n">num_files_used</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nc_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">nc_file_types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns dict of netCDF4 objects of a station&#39;s netcdf files&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s2">&quot;historic&quot;</span><span class="p">:</span>
                <span class="n">ht</span> <span class="o">=</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ht</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">ht</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span><span class="o">.</span><span class="n">nc</span>
            <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s2">&quot;archive&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
                    <span class="n">ar</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">ar</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ar</span>
            <span class="k">if</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">active_datasets</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
                    <span class="n">ac</span> <span class="o">=</span> <span class="n">Active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ac</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ac</span>
                    <span class="n">ac</span> <span class="o">=</span> <span class="n">ActiveXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ac</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">result</span><span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ac</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_target_timespan</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">target_timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_target_records</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_var</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a timespan containing the n closest records to the target_timestamp.</span>

<span class="sd">        PARAMETERS</span>
<span class="sd">        ----------</span>
<span class="sd">        target_timestamp : int</span>
<span class="sd">            A unix timestamp which is the target time about which the closest</span>
<span class="sd">            n records will be returned.</span>
<span class="sd">        n : int</span>
<span class="sd">            The number of records to return that are closest to the target</span>
<span class="sd">            timestamp.</span>
<span class="sd">        time_var : str</span>
<span class="sd">            The name of the time dimension variable to use. E.g. waveTime.</span>

<span class="sd">        RETURNS</span>
<span class="sd">        -------</span>
<span class="sd">        A 2-tuple of timestamps corresponding to i and i+n (where n may</span>
<span class="sd">        be negative) which will be the timestamps for the n records</span>
<span class="sd">        closest to the target_timestamp.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r_ok</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_ok</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">h_ok</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h_ok</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Check realtime to find closest index</span>

        <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">r_ok</span><span class="p">:</span>
            <span class="n">r_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">time_var</span><span class="p">)[:]</span>
            <span class="n">r_last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">i_b</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">r_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span><span class="p">)</span>
            <span class="c1"># i_b will be possibly one more than the last index</span>
            <span class="n">i_b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i_b</span><span class="p">,</span> <span class="n">r_last_idx</span><span class="p">)</span>
            <span class="c1"># Target timestamp is exactly equal to a data time</span>
            <span class="k">if</span> <span class="n">i_b</span> <span class="o">==</span> <span class="n">r_last_idx</span> <span class="ow">or</span> <span class="n">r_stamps</span><span class="p">[</span><span class="n">i_b</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_timestamp</span><span class="p">:</span>
                <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
            <span class="k">elif</span> <span class="n">i_b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_closest_index</span><span class="p">(</span>
                    <span class="n">i_b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_b</span><span class="p">,</span> <span class="n">r_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span>
                <span class="p">)</span>

        <span class="c1"># If closest index not found, check historic</span>

        <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">h_last_idx</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Let&#39;s us know if h_stamps has been loaded</span>
        <span class="k">if</span> <span class="n">h_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">r_closest_idx</span><span class="p">:</span>
            <span class="n">h_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">time_var</span><span class="p">)[:]</span>
            <span class="n">h_last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">i_b</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span><span class="p">)</span>
            <span class="n">i_b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i_b</span><span class="p">,</span> <span class="n">h_last_idx</span><span class="p">)</span>
            <span class="c1"># Target timestamp is exactly equal to a data time</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i_b</span> <span class="o">&lt;=</span> <span class="n">h_last_idx</span> <span class="ow">and</span> <span class="n">h_stamps</span><span class="p">[</span><span class="n">i_b</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_timestamp</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i_b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
            <span class="k">elif</span> <span class="n">i_b</span> <span class="o">&gt;=</span> <span class="n">h_last_idx</span><span class="p">:</span>  <span class="c1"># Target is between the two files</span>
                <span class="k">if</span> <span class="n">r_ok</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">[</span><span class="n">h_last_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_timestamp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span>
                        <span class="n">r_stamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_timestamp</span>
                    <span class="p">):</span>
                        <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># No realtime file</span>
                    <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Within middle of historic stamps</span>
                <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_closest_index</span><span class="p">(</span>
                    <span class="n">i_b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_b</span><span class="p">,</span> <span class="n">h_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span>
                <span class="p">)</span>

        <span class="c1"># Now we have the closest index, find the intervals</span>

        <span class="k">if</span> <span class="n">r_closest_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
                <span class="n">r_stamps</span><span class="p">,</span> <span class="n">r_closest_idx</span><span class="p">,</span> <span class="n">num_target_records</span>
            <span class="p">)</span>
            <span class="c1"># If bound exceeded toward H and H exists, cacluate h_interval</span>
            <span class="k">if</span> <span class="n">r_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">h_ok</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">h_last_idx</span><span class="p">:</span>
                    <span class="n">h_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">time_var</span><span class="p">)[:]</span>
                    <span class="n">h_last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">h_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
                    <span class="n">h_stamps</span><span class="p">,</span> <span class="n">h_last_idx</span><span class="p">,</span> <span class="n">num_target_records</span> <span class="o">+</span> <span class="n">r_closest_idx</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">combine_intervals</span><span class="p">(</span><span class="n">h_interval</span><span class="p">,</span> <span class="n">r_interval</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">r_interval</span>
        <span class="k">elif</span> <span class="n">h_closest_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
                <span class="n">h_stamps</span><span class="p">,</span> <span class="n">h_closest_idx</span><span class="p">,</span> <span class="n">num_target_records</span>
            <span class="p">)</span>
            <span class="c1"># If bound exceeded toward R and R exists, cacluate r_interval</span>
            <span class="k">if</span> <span class="n">h_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r_ok</span><span class="p">:</span>
                <span class="n">r_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
                    <span class="n">r_stamps</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_target_records</span> <span class="o">+</span> <span class="n">h_closest_idx</span> <span class="o">-</span> <span class="n">h_last_idx</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">combine_intervals</span><span class="p">(</span><span class="n">h_interval</span><span class="p">,</span> <span class="n">r_interval</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">h_interval</span>

        <span class="c1"># If we get to here there&#39;s a problem</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.__aggregate_dicts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">dict1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dict2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a dict of data combined from two dictionaries. Dict1 has oldest data.
All the other __merge methods end up using this method.</p>
<p>This method also redistributes 100 band spectra to 64 band format if 1) both
formats are present in dict1 and dict2 or 2) the force_64bands option is True.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__aggregate_dicts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dict2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dict of data combined from two dictionaries. Dict1 has oldest data.</span>
<span class="sd">    All the other __merge methods end up using this method.</span>

<span class="sd">    This method also redistributes 100 band spectra to 64 band format if 1) both</span>
<span class="sd">    formats are present in dict1 and dict2 or 2) the force_64bands option is True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Union the keys to make sure we check each one</span>
    <span class="n">ukeys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="c1"># Determine if there are any spectra vars to redistribute</span>
    <span class="n">svars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spectrum_vars</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ukeys</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">svars</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">svars</span><span class="p">))</span>  <span class="c1"># retrieves an element from the set</span>
        <span class="n">shape1</span> <span class="o">=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">shape2</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape1</span><span class="p">,</span> <span class="n">shape2</span><span class="p">]</span>
        <span class="k">if</span> <span class="mi">100</span> <span class="ow">in</span> <span class="n">shapes</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force_64bands</span> <span class="ow">or</span> <span class="mi">64</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">):</span>
            <span class="n">dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">dict1</span><span class="p">,</span> <span class="n">dict2</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
                    <span class="n">spectra_obj</span> <span class="o">=</span> <span class="n">Spectra</span><span class="p">()</span>
                    <span class="n">spectra_obj</span><span class="o">.</span><span class="n">set_spectrumArr_fromQuery</span><span class="p">(</span><span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">spectra_obj</span><span class="o">.</span><span class="n">redist_specArr</span><span class="p">(</span><span class="s2">&quot;Spectrum_64band&quot;</span><span class="p">)</span>
                    <span class="n">redistributed_dict</span> <span class="o">=</span> <span class="n">spectra_obj</span><span class="o">.</span><span class="n">specArr_ToDict</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_vars</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">dicts</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">redistributed_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
    <span class="c1"># Concatenate the variables</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">ukeys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict1</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict2</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">dict1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">deploy_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <h6 id="cdippy.stndata.StnData.__init__--parameters">PARAMETERS</h6>
<p>stn : str
   Can be in 2, 3 or 5 char format e.g. 28, 028, 028p2
data_dir : str [optional]
    Either a full path to a directory containing a local directory hierarchy
    of nc files. E.g. '/project/WNC' or a url to a THREDDS server.
org: str
    (Organization) Values are: cdip|ww3|external
deploy_num : int [optional]
    Supply this to access specific station deployment data.
    Must be &gt;= 1.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">stn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">org</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">deploy_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    stn : str</span>
<span class="sd">       Can be in 2, 3 or 5 char format e.g. 28, 028, 028p2</span>
<span class="sd">    data_dir : str [optional]</span>
<span class="sd">        Either a full path to a directory containing a local directory hierarchy</span>
<span class="sd">        of nc files. E.g. &#39;/project/WNC&#39; or a url to a THREDDS server.</span>
<span class="sd">    org: str</span>
<span class="sd">        (Organization) Values are: cdip|ww3|external</span>
<span class="sd">    deploy_num : int [optional]</span>
<span class="sd">        Supply this to access specific station deployment data.</span>
<span class="sd">        Must be &gt;= 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nc</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stn</span> <span class="o">=</span> <span class="n">stn</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">data_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">org</span> <span class="o">=</span> <span class="n">org</span>

    <span class="c1"># Accept numbers for cdip stations</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">stn</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;p1&quot;</span>

    <span class="c1"># Initialize nc file used for meta information</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="o">=</span> <span class="n">deploy_num</span>
    <span class="k">if</span> <span class="n">deploy_num</span><span class="p">:</span>
        <span class="c1"># Check all active datasets in this order p3 -&gt; p2 -&gt; p1 -&gt; p0</span>
        <span class="n">p_lookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([[</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">__found_active_meta</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">p_lookup</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Active</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="n">p_lookup</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                <span class="n">__found_active_meta</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">__found_active_meta</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historic</span> <span class="o">=</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="o">=</span> <span class="n">Realtime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.__merge_active_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__merge_active_request</span><span class="p">(</span><span class="n">nc_class_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns data for a given request across active datasets.</p>
<p>When deploy_num is supplied all files (active and archive)
are checked for data.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__merge_active_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nc_class_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rt&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns data for a given request across active datasets.</span>

<span class="sd">    When deploy_num is supplied all files (active and archive)</span>
<span class="sd">    are checked for data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sorted_datasets</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">active_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">num_files_used</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">sorted_datasets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nc_class_type</span> <span class="o">==</span> <span class="s2">&quot;xyz&quot;</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">ActiveXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;moored&quot;</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;p1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
            <span class="n">a</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
            <span class="n">a</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
            <span class="n">a</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
            <span class="n">a</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
            <span class="n">tmp_result</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">tmp_result</span><span class="p">)</span>
            <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">num_files_used</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.__merge_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__merge_request</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns data for given request across realtime and historic files</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__merge_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns data for given request across realtime and historic files&quot;&quot;&quot;</span>

    <span class="n">num_files_used</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span>
    <span class="c1"># Note that we are assuming that waveTime will work for every time dim.</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;waveTime&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">:</span>
        <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">r</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
        <span class="n">r</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
        <span class="n">r</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
        <span class="n">r</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
        <span class="n">r</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
        <span class="n">rt</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

    <span class="n">ht</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span>
    <span class="c1"># Historic file contains public data</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">h</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">h</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="s2">&quot;waveTime&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">==</span> <span class="s2">&quot;public&quot;</span>
    <span class="p">):</span>
        <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">h</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span>
        <span class="n">h</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span>
        <span class="n">h</span><span class="o">.</span><span class="n">end_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span>
        <span class="n">h</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>
        <span class="n">h</span><span class="o">.</span><span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>
        <span class="n">ht</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>

    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__aggregate_dicts</span><span class="p">(</span><span class="n">ht</span><span class="p">,</span> <span class="n">rt</span><span class="p">)</span>

    <span class="c1"># Check Archive files if requesting non-pub data</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span> <span class="o">!=</span> <span class="s2">&quot;public&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
            <span class="n">ar</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">num_files_used</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_archive_helper</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
            <span class="c1"># Break if file start stamp is greater than request end stamp</span>
            <span class="k">if</span> <span class="n">start_stamp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">:</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="n">num_files_used</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.__merge_xyz_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__merge_xyz_request</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Merge xyz data from realtime and archive nc files.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">__merge_xyz_request</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge xyz data from realtime and archive nc files.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;xyzData&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;xyzXDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzYDisplacement&quot;</span><span class="p">,</span> <span class="s2">&quot;xyzZDisplacement&quot;</span><span class="p">]</span>
    <span class="n">request_timespan</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">)</span>
    <span class="n">arch_file_used</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">rt_file_used</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># First get realtime data if it exists</span>
    <span class="n">rt</span> <span class="o">=</span> <span class="n">RealtimeXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rt</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rt_file_used</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_xyz_helper</span><span class="p">(</span><span class="n">rt</span><span class="p">,</span> <span class="n">request_timespan</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

    <span class="c1"># If the request start time is more recent than the realtime</span>
    <span class="c1"># start time, no need to look in the archives</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">&gt;</span> <span class="n">start_stamp</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Second, look in archive files for data</span>
    <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">arch_file_used</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">result</span><span class="p">,</span> <span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_xyz_helper</span><span class="p">(</span><span class="n">ar</span><span class="p">,</span> <span class="n">request_timespan</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="c1"># Break if file start stamp is greater than request end stamp</span>
        <span class="k">if</span> <span class="n">start_stamp</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_stamp</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">rt_file_used</span> <span class="ow">and</span> <span class="n">arch_file_used</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_nc_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_nc_files</span><span class="p">(</span><span class="n">types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">nc_file_types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns dict of netCDF4 objects of a station's netcdf files</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_nc_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="n">nc_file_types</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns dict of netCDF4 objects of a station&#39;s netcdf files&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="n">types</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s2">&quot;historic&quot;</span><span class="p">:</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="n">Historic</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ht</span><span class="o">.</span><span class="n">nc</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">ht</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ht</span><span class="o">.</span><span class="n">nc</span>
        <span class="k">if</span> <span class="n">ftype</span> <span class="o">==</span> <span class="s2">&quot;archive&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
                <span class="n">ar</span> <span class="o">=</span> <span class="n">Archive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ar</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">result</span><span class="p">[</span><span class="n">ar</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ar</span>
        <span class="k">if</span> <span class="n">ftype</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">active_datasets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_deployments</span><span class="p">):</span>
                <span class="n">ac</span> <span class="o">=</span> <span class="n">Active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ac</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ac</span>
                <span class="n">ac</span> <span class="o">=</span> <span class="n">ActiveXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stn</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">ftype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ac</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">result</span><span class="p">[</span><span class="n">ac</span><span class="o">.</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">ac</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_parameters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_parameters</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="n">apply_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">target_records</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calls get_series to return wave parameters.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_parameters</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
    <span class="n">apply_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">target_records</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls get_series to return wave parameters.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vars</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">,</span> <span class="n">target_records</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_series</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">vrs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">target_records</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">force_64bands</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a dict of data between start and end dates with specified quality.</p>
<h6 id="cdippy.stndata.StnData.get_series--parameters">PARAMETERS</h6>
<p>start : str or datetime [optional] : default Jan 1, 1975
    Start time of data request (UTC). If provided as a string must
    be in the format Y-m-d H:M:S where Y is 4 chars and all others
    are 2 chars. Ex. '2020-03-30 19:32:56'.
end : str or datetime [optional] : default now
    End time of data request (UTC). If not supplied defaults to now.
vrs : list [optional] : default ['waveHs']
    A list of the names of variables to retrieve. They all must start
    with the same prefix, e.g. ['waveHs', 'waveTp', 'waveDp']
pub_set: str [optional] values = public|nonpub|all
    Filters data based on data quality flags.
apply_mask: bool [optional] default True
    Removes values from the masked array that have a mask value of True.
    Ex. If nonpub data is requested and apply_mask is False, the returned
    array will contain both public and nonpublic data (although public
    data records will have the mask value set to True). If apply_mask
    is set to True, only nonpub records will be returned.
target_records: int [optional]
    If start is specified and end is None, this will specify the number
    of additional records to return closest to start.
force_64bands: bool [optional]
    For the case in which all spectra returned are mk4 100 band format,
    force the conversion to 64bands. Mixed formats are always returned in mk3
    64 band format.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_series</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">vrs</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_records</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">force_64bands</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a dict of data between start and end dates with specified quality.</span>

<span class="sd">    PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    start : str or datetime [optional] : default Jan 1, 1975</span>
<span class="sd">        Start time of data request (UTC). If provided as a string must</span>
<span class="sd">        be in the format Y-m-d H:M:S where Y is 4 chars and all others</span>
<span class="sd">        are 2 chars. Ex. &#39;2020-03-30 19:32:56&#39;.</span>
<span class="sd">    end : str or datetime [optional] : default now</span>
<span class="sd">        End time of data request (UTC). If not supplied defaults to now.</span>
<span class="sd">    vrs : list [optional] : default [&#39;waveHs&#39;]</span>
<span class="sd">        A list of the names of variables to retrieve. They all must start</span>
<span class="sd">        with the same prefix, e.g. [&#39;waveHs&#39;, &#39;waveTp&#39;, &#39;waveDp&#39;]</span>
<span class="sd">    pub_set: str [optional] values = public|nonpub|all</span>
<span class="sd">        Filters data based on data quality flags.</span>
<span class="sd">    apply_mask: bool [optional] default True</span>
<span class="sd">        Removes values from the masked array that have a mask value of True.</span>
<span class="sd">        Ex. If nonpub data is requested and apply_mask is False, the returned</span>
<span class="sd">        array will contain both public and nonpublic data (although public</span>
<span class="sd">        data records will have the mask value set to True). If apply_mask</span>
<span class="sd">        is set to True, only nonpub records will be returned.</span>
<span class="sd">    target_records: int [optional]</span>
<span class="sd">        If start is specified and end is None, this will specify the number</span>
<span class="sd">        of additional records to return closest to start.</span>
<span class="sd">    force_64bands: bool [optional]</span>
<span class="sd">        For the case in which all spectra returned are mk4 100 band format,</span>
<span class="sd">        force the conversion to 64bands. Mixed formats are always returned in mk3</span>
<span class="sd">        64 band format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">vrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameter_vars</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">vrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Target time</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="n">ts_I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_target_timespan</span><span class="p">(</span>
            <span class="n">cdip_utils</span><span class="o">.</span><span class="n">datetime_to_timestamp</span><span class="p">(</span><span class="n">start</span><span class="p">),</span> <span class="n">target_records</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ts_I</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">timestamp_to_datetime</span><span class="p">(</span><span class="n">ts_I</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">timestamp_to_datetime</span><span class="p">(</span><span class="n">ts_I</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Use default 3 days back</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">pub_set</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pub_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_set</span>

    <span class="k">if</span> <span class="n">apply_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">apply_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_mask</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">force_64bands</span> <span class="o">=</span> <span class="n">force_64bands</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_request_info</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">vrs</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;xyz&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_xyz_request</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s2">&quot;xyz&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_active_request</span><span class="p">(</span><span class="s2">&quot;xyz&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">deploy_num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_request</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__merge_active_request</span><span class="p">(</span><span class="s2">&quot;rt&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_spectra" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spectra</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">,</span> <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">target_records</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">force_64bands</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calls get_series to return spectral data.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_spectra</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span><span class="p">,</span>
    <span class="n">apply_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">target_records</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">force_64bands</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls get_series to return spectral data.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span>
        <span class="n">start</span><span class="p">,</span>
        <span class="n">end</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrum_vars</span><span class="p">,</span>
        <span class="n">pub_set</span><span class="p">,</span>
        <span class="n">apply_mask</span><span class="p">,</span>
        <span class="n">target_records</span><span class="p">,</span>
        <span class="n">force_64bands</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_stn_meta" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_stn_meta</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a dict of station meta data.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_stn_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a dict of station meta data.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">set_request_info</span><span class="p">(</span><span class="n">vrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_vars</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">get_request</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">):</span>
            <span class="n">result</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_target_timespan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_target_timespan</span><span class="p">(</span><span class="n">target_timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_target_records</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Returns a timespan containing the n closest records to the target_timestamp.</p>
<h6 id="cdippy.stndata.StnData.get_target_timespan--parameters">PARAMETERS</h6>
<p>target_timestamp : int
    A unix timestamp which is the target time about which the closest
    n records will be returned.
n : int
    The number of records to return that are closest to the target
    timestamp.
time_var : str
    The name of the time dimension variable to use. E.g. waveTime.</p>
<h6 id="cdippy.stndata.StnData.get_target_timespan--returns">RETURNS</h6>
<p>A 2-tuple of timestamps corresponding to i and i+n (where n may
be negative) which will be the timestamps for the n records
closest to the target_timestamp.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_target_timespan</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">target_timestamp</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_target_records</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">time_var</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a timespan containing the n closest records to the target_timestamp.</span>

<span class="sd">    PARAMETERS</span>
<span class="sd">    ----------</span>
<span class="sd">    target_timestamp : int</span>
<span class="sd">        A unix timestamp which is the target time about which the closest</span>
<span class="sd">        n records will be returned.</span>
<span class="sd">    n : int</span>
<span class="sd">        The number of records to return that are closest to the target</span>
<span class="sd">        timestamp.</span>
<span class="sd">    time_var : str</span>
<span class="sd">        The name of the time dimension variable to use. E.g. waveTime.</span>

<span class="sd">    RETURNS</span>
<span class="sd">    -------</span>
<span class="sd">    A 2-tuple of timestamps corresponding to i and i+n (where n may</span>
<span class="sd">    be negative) which will be the timestamps for the n records</span>
<span class="sd">    closest to the target_timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r_ok</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r_ok</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">h_ok</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">nc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h_ok</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Check realtime to find closest index</span>

    <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">r_ok</span><span class="p">:</span>
        <span class="n">r_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">time_var</span><span class="p">)[:]</span>
        <span class="n">r_last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">i_b</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">r_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span><span class="p">)</span>
        <span class="c1"># i_b will be possibly one more than the last index</span>
        <span class="n">i_b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i_b</span><span class="p">,</span> <span class="n">r_last_idx</span><span class="p">)</span>
        <span class="c1"># Target timestamp is exactly equal to a data time</span>
        <span class="k">if</span> <span class="n">i_b</span> <span class="o">==</span> <span class="n">r_last_idx</span> <span class="ow">or</span> <span class="n">r_stamps</span><span class="p">[</span><span class="n">i_b</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_timestamp</span><span class="p">:</span>
            <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
        <span class="k">elif</span> <span class="n">i_b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_closest_index</span><span class="p">(</span>
                <span class="n">i_b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_b</span><span class="p">,</span> <span class="n">r_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span>
            <span class="p">)</span>

    <span class="c1"># If closest index not found, check historic</span>

    <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">h_last_idx</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Let&#39;s us know if h_stamps has been loaded</span>
    <span class="k">if</span> <span class="n">h_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">r_closest_idx</span><span class="p">:</span>
        <span class="n">h_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">time_var</span><span class="p">)[:]</span>
        <span class="n">h_last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">i_b</span> <span class="o">=</span> <span class="n">bisect_left</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span><span class="p">)</span>
        <span class="n">i_b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i_b</span><span class="p">,</span> <span class="n">h_last_idx</span><span class="p">)</span>
        <span class="c1"># Target timestamp is exactly equal to a data time</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i_b</span> <span class="o">&lt;=</span> <span class="n">h_last_idx</span> <span class="ow">and</span> <span class="n">h_stamps</span><span class="p">[</span><span class="n">i_b</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_timestamp</span><span class="p">)</span> <span class="ow">or</span> <span class="n">i_b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
        <span class="k">elif</span> <span class="n">i_b</span> <span class="o">&gt;=</span> <span class="n">h_last_idx</span><span class="p">:</span>  <span class="c1"># Target is between the two files</span>
            <span class="k">if</span> <span class="n">r_ok</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">[</span><span class="n">h_last_idx</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_timestamp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">abs</span><span class="p">(</span>
                    <span class="n">r_stamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">target_timestamp</span>
                <span class="p">):</span>
                    <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">r_closest_idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># No realtime file</span>
                <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">i_b</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Within middle of historic stamps</span>
            <span class="n">h_closest_idx</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_closest_index</span><span class="p">(</span>
                <span class="n">i_b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_b</span><span class="p">,</span> <span class="n">h_stamps</span><span class="p">,</span> <span class="n">target_timestamp</span>
            <span class="p">)</span>

    <span class="c1"># Now we have the closest index, find the intervals</span>

    <span class="k">if</span> <span class="n">r_closest_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">r_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
            <span class="n">r_stamps</span><span class="p">,</span> <span class="n">r_closest_idx</span><span class="p">,</span> <span class="n">num_target_records</span>
        <span class="p">)</span>
        <span class="c1"># If bound exceeded toward H and H exists, cacluate h_interval</span>
        <span class="k">if</span> <span class="n">r_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">h_ok</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">h_last_idx</span><span class="p">:</span>
                <span class="n">h_stamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historic</span><span class="o">.</span><span class="n">get_var</span><span class="p">(</span><span class="n">time_var</span><span class="p">)[:]</span>
                <span class="n">h_last_idx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_stamps</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">h_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
                <span class="n">h_stamps</span><span class="p">,</span> <span class="n">h_last_idx</span><span class="p">,</span> <span class="n">num_target_records</span> <span class="o">+</span> <span class="n">r_closest_idx</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">combine_intervals</span><span class="p">(</span><span class="n">h_interval</span><span class="p">,</span> <span class="n">r_interval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r_interval</span>
    <span class="k">elif</span> <span class="n">h_closest_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
            <span class="n">h_stamps</span><span class="p">,</span> <span class="n">h_closest_idx</span><span class="p">,</span> <span class="n">num_target_records</span>
        <span class="p">)</span>
        <span class="c1"># If bound exceeded toward R and R exists, cacluate r_interval</span>
        <span class="k">if</span> <span class="n">h_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">r_ok</span><span class="p">:</span>
            <span class="n">r_interval</span> <span class="o">=</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">get_interval</span><span class="p">(</span>
                <span class="n">r_stamps</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_target_records</span> <span class="o">+</span> <span class="n">h_closest_idx</span> <span class="o">-</span> <span class="n">h_last_idx</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">cdip_utils</span><span class="o">.</span><span class="n">combine_intervals</span><span class="p">(</span><span class="n">h_interval</span><span class="p">,</span> <span class="n">r_interval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">h_interval</span>

    <span class="c1"># If we get to here there&#39;s a problem</span>
    <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.get_xyz" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_xyz</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;public&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calls get_series to return displacement data.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_xyz</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calls get_series to return displacement data.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_series</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_vars</span><span class="p">,</span> <span class="n">pub_set</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cdippy.stndata.StnData.remove_duplicates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_duplicates</span><span class="p">(</span><span class="n">data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Duplicate records may exist after merge_ routines. This removes them.</p>


            <details class="quote">
              <summary>Source code in <code>cdippy/stndata.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_duplicates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Duplicate records may exist after merge_ routines. This removes them.&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_var_prefix</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">time_dimension_name</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s2">&quot;Time&quot;</span>
        <span class="n">time_values</span><span class="p">,</span> <span class="n">indices_of_unique_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">data_dict</span><span class="p">[</span><span class="n">time_dimension_name</span><span class="p">],</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">time_dimension_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_values</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">time_dimension_name</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">indices_of_unique_values</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_dict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../quickstart/" class="btn btn-neutral float-left" title="Quick start"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../user_guide/" class="btn btn-neutral float-right" title="Installation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../quickstart/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../user_guide/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
